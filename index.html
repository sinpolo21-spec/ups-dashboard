<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise UPS Management System - Advanced Analytics Platform</title>
    
    <!-- Advanced Libraries -->
    <script src="https://unpkg.com/three@0.157.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.157.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://unpkg.com/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://unpkg.com/ml-matrix@6.10.4/lib-esm/index.js" type="module"></script>
    <script src="https://unpkg.com/d3@7.8.5/dist/d3.min.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --accent-blue: #5dade2;
            --accent-green: #58d68d;
            --accent-purple: #bb8fce;
            --accent-orange: #f7dc6f;
            --danger: #ec7063;
            --warning: #f39c12;
            --success: #27ae60;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: radial-gradient(ellipse at top, #1a1a2e, #16213e), 
                        linear-gradient(135deg, #0f0f23, #1a1a2e);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            font-weight: 400;
            line-height: 1.6;
        }

        /* Advanced Loading System */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20000;
        }

        .loading-logo {
            width: 120px;
            height: 120px;
            border: 4px solid transparent;
            border-top: 4px solid #667eea;
            border-right: 4px solid #764ba2;
            border-bottom: 4px solid #f093fb;
            border-radius: 50%;
            animation: complexSpin 2s linear infinite;
            margin-bottom: 30px;
            position: relative;
        }

        .loading-logo::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            animation: complexSpin 1.5s linear infinite reverse;
        }

        @keyframes complexSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .loading-text {
            color: var(--accent-blue);
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .loading-progress {
            width: 300px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .loading-progress-bar {
            width: 0%;
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .loading-status {
            color: var(--text-secondary);
            font-size: 14px;
            text-align: center;
        }

        /* Advanced Login Portal */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.95), rgba(26, 26, 46, 0.95));
            backdrop-filter: blur(20px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .login-container {
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border: 2px solid var(--glass-border);
            border-radius: 28px;
            padding: 60px;
            text-align: center;
            box-shadow: 0 30px 80px rgba(0,0,0,0.6);
            min-width: 520px;
            animation: loginGlide 0.8s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes loginGlide {
            from { opacity: 0; transform: translateY(-60px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .login-title {
            font-size: 3.2rem;
            margin-bottom: 20px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            letter-spacing: -2px;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-size: 1.3rem;
            font-weight: 300;
        }

        .login-input {
            width: 100%;
            padding: 22px 28px;
            margin-bottom: 28px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 18px;
            background: rgba(255,255,255,0.05);
            color: var(--text-primary);
            font-size: 17px;
            backdrop-filter: blur(10px);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            font-weight: 500;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 40px rgba(102, 126, 234, 0.5);
            transform: scale(1.02);
            background: rgba(255,255,255,0.1);
        }

        .login-btn {
            width: 100%;
            padding: 22px;
            border: none;
            border-radius: 18px;
            background: var(--primary-gradient);
            color: white;
            font-size: 19px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
        }

        .login-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 60px rgba(102, 126, 234, 0.6);
        }

        /* Advanced Header */
        .header {
            background: var(--primary-gradient);
            color: white;
            padding: 50px 30px;
            text-align: center;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 4s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header h1 {
            font-size: 4rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 12px rgba(0,0,0,0.4);
            font-weight: 900;
            letter-spacing: -3px;
        }

        .header p {
            font-size: 1.5rem;
            opacity: 0.95;
            font-weight: 300;
            letter-spacing: 1px;
        }

        /* Advanced Container */
        .container {
            max-width: 2000px;
            margin: 0 auto;
            padding: 40px;
        }

        /* Advanced Grid System */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .main-panel, .side-panel {
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        /* Advanced Panel System */
        .panel {
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border: 2px solid var(--glass-border);
            border-radius: 28px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            border-radius: 28px 28px 0 0;
        }

        .panel:hover {
            transform: translateY(-8px);
            box-shadow: 0 30px 80px rgba(0,0,0,0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Advanced Control Panel */
        .control-panel {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.2), rgba(46, 204, 113, 0.1));
            border-color: rgba(39, 174, 96, 0.3);
        }

        .control-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .btn {
            padding: 20px 35px;
            border: none;
            border-radius: 18px;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }

        .btn-start { 
            background: linear-gradient(135deg, #27ae60, #2ecc71, #58d68d); 
            color: white;
        }
        .btn-stop { 
            background: linear-gradient(135deg, #e74c3c, #c0392b, #ec7063); 
            color: white;
        }
        .btn-export { 
            background: linear-gradient(135deg, #3498db, #2980b9, #5dade2); 
            color: white;
        }
        .btn-ai { 
            background: linear-gradient(135deg, #9b59b6, #8e44ad, #bb8fce); 
            color: white;
        }
        .btn-simulate { 
            background: linear-gradient(135deg, #f39c12, #e67e22, #f7dc6f); 
            color: white;
        }
        .btn-analyze { 
            background: linear-gradient(135deg, #16a085, #1abc9c, #7fb3d3); 
            color: white;
        }

        /* Advanced Status System */
        .status {
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 25px;
            padding: 30px;
            background: rgba(39, 174, 96, 0.15);
            border-radius: 18px;
            border-left: 6px solid var(--success);
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.2);
        }

        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--success);
            animation: advancedPulse 2s infinite;
            box-shadow: 0 0 25px var(--success);
        }

        @keyframes advancedPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.3); box-shadow: 0 0 40px var(--success); }
        }

        /* Advanced Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 35px;
            text-align: center;
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary-gradient);
            background-size: 400% 100%;
            animation: gradientFlow 5s ease infinite;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .metric-card:hover {
            transform: translateY(-12px) scale(1.05);
            box-shadow: 0 25px 60px rgba(0,0,0,0.4);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .metric-title {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 18px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
        }

        .metric-value {
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 12px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
        }

        .metric-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            opacity: 0.8;
        }

        /* Advanced Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .chart-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border: 2px solid var(--glass-border);
            border-radius: 28px;
            padding: 35px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .chart-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .chart-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
            letter-spacing: 0.5px;
        }

        .chart-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-weight: 500;
        }

        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }

        /* Advanced 3D Container */
        .topology-3d {
            height: 450px;
            background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(0,0,0,0.3));
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            border: 2px solid var(--glass-border);
            box-shadow: inset 0 4px 25px rgba(0,0,0,0.5);
        }

        /* Advanced AI Panel */
        .ai-panel {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.25), rgba(142, 68, 173, 0.15));
            border: 2px solid rgba(155, 89, 182, 0.4);
        }

        .ai-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 30px;
            color: var(--accent-purple);
            letter-spacing: 0.5px;
        }

        .ai-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .ai-metric {
            background: rgba(155, 89, 182, 0.2);
            padding: 25px;
            border-radius: 18px;
            text-align: center;
            border: 2px solid rgba(155, 89, 182, 0.4);
            transition: all 0.3s ease;
        }

        .ai-metric:hover {
            transform: scale(1.05);
            border-color: rgba(155, 89, 182, 0.6);
        }

        .ai-metric-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ai-metric-value {
            font-size: 22px;
            font-weight: 800;
            color: var(--accent-purple);
        }

        /* Advanced Configuration Panel */
        .advanced-config {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.25), rgba(41, 128, 185, 0.15));
            border: 2px solid rgba(52, 152, 219, 0.4);
        }

        .config-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .config-tab {
            padding: 16px 24px;
            background: rgba(52, 152, 219, 0.15);
            border: 2px solid rgba(52, 152, 219, 0.3);
            border-radius: 14px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            transition: all 0.4s ease;
            white-space: nowrap;
            letter-spacing: 0.8px;
        }

        .config-tab.active {
            background: rgba(52, 152, 219, 0.4);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .config-content {
            display: none;
            animation: fadeInUp 0.4s ease-in-out;
        }

        .config-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Advanced Controls */
        .controls-section {
            margin-bottom: 35px;
        }

        .controls-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--accent-blue);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .control-group label {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }

        .control-group input, .control-group select {
            padding: 18px 24px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 14px;
            font-size: 16px;
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            font-weight: 500;
        }

        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 25px rgba(93, 173, 226, 0.4);
            transform: scale(1.02);
            background: rgba(255,255,255,0.15);
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .range-input {
            flex: 1;
            height: 10px;
            border-radius: 5px;
            background: rgba(255,255,255,0.2);
            outline: none;
            transition: all 0.3s ease;
        }

        .range-input::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-gradient);
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }

        .range-value {
            font-size: 16px;
            color: var(--accent-blue);
            font-weight: 700;
            min-width: 120px;
            text-align: center;
            background: rgba(93, 173, 226, 0.15);
            padding: 14px 22px;
            border-radius: 12px;
            border: 2px solid rgba(93, 173, 226, 0.4);
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        /* Advanced Financial Panel */
        .financial-panel {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.2), rgba(46, 204, 113, 0.1));
            border: 2px solid rgba(39, 174, 96, 0.4);
        }

        .financial-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 15px;
            line-height: 1.6;
        }

        .financial-item:last-child {
            border-bottom: none;
        }

        .financial-label {
            color: var(--text-secondary);
            font-weight: 600;
        }

        .financial-value {
            font-weight: 700;
            font-size: 16px;
        }

        .financial-value.cost { color: var(--accent-blue); }
        .financial-value.savings { color: var(--accent-green); }
        .financial-value.roi { color: var(--accent-orange); }

        /* Advanced Notification System */
        .notification {
            position: fixed;
            top: 40px;
            right: 40px;
            background: linear-gradient(135deg, var(--success), #2ecc71);
            color: white;
            padding: 25px 35px;
            border-radius: 18px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            z-index: 1000;
            max-width: 450px;
            animation: slideInRight 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            border-left: 6px solid #ffffff;
            font-weight: 600;
        }

        .notification.error { background: linear-gradient(135deg, var(--danger), #c0392b); }
        .notification.info { background: linear-gradient(135deg, var(--accent-blue), #2980b9); }
        .notification.warning { background: linear-gradient(135deg, var(--warning), #e67e22); }

        @keyframes slideInRight {
            from { transform: translateX(120%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Advanced Modal System */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 5000;
        }

        .modal {
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border: 2px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlideIn 0.4s ease-out;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.9) translateY(-50px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* Advanced Responsive Design */
        @media (max-width: 1600px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .charts-container { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .container { padding: 25px; }
            .header h1 { font-size: 2.8rem; }
            .header p { font-size: 1.2rem; }
            .control-buttons { grid-template-columns: 1fr; }
            .metrics-grid { grid-template-columns: 1fr; }
            .ai-metrics { grid-template-columns: 1fr; }
            .input-group { grid-template-columns: 1fr; }
            .config-tabs { flex-wrap: wrap; }
            .login-container { min-width: 340px; margin: 25px; padding: 40px; }
        }

        /* Advanced Loading States */
        .loading-state {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--accent-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Advanced Tooltips */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Advanced Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo"></div>
        <div class="loading-text">Enterprise UPS System</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingProgress"></div>
        </div>
        <div class="loading-status" id="loadingStatus">Initializing core systems...</div>
    </div>

    <!-- Advanced Login Portal -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <h1 class="login-title">Enterprise Portal</h1>
            <p class="login-subtitle">Advanced UPS Management System</p>
            <form id="loginForm">
                <input type="text" class="login-input" id="username" placeholder="Username" required>
                <input type="password" class="login-input" id="password" placeholder="Password" required>
                <button type="submit" class="login-btn">Access Enterprise Dashboard</button>
            </form>
            <div class="login-error" id="loginError"></div>
            <div class="security-notice">
                <strong>Enterprise Security Notice:</strong> This system requires authenticated access to advanced UPS analytics and AI-driven optimization systems.<br>
                <strong>Demo Access:</strong> admin / enterprise2024
            </div>
        </div>
    </div>

    <!-- Main Enterprise Dashboard -->
    <div id="mainDashboard" style="display: none;">
        <div class="header">
            <h1>Enterprise UPS Management System</h1>
            <p>AI-Driven Power Analytics | Predictive Maintenance | Real-time Optimization</p>
        </div>
        
        <div class="container">
            <div class="dashboard-grid">
                <div class="main-panel">
                    <!-- Advanced Control Center -->
                    <div class="panel control-panel">
                        <h3 style="font-size: 28px; font-weight: 800; margin-bottom: 30px; color: var(--accent-green);">Mission Control Center</h3>
                        <div class="control-buttons">
                            <button class="btn btn-start" onclick="startSystem()">Start System</button>
                            <button class="btn btn-stop" onclick="stopSystem()">Emergency Stop</button>
                            <button class="btn btn-simulate" onclick="runSimulation()">Run Simulation</button>
                            <button class="btn btn-analyze" onclick="performAnalysis()">Deep Analysis</button>
                            <button class="btn btn-export" onclick="exportReport()">Export Report</button>
                            <button class="btn btn-ai" onclick="toggleAIMode()">AI Optimization</button>
                        </div>
                        <div class="status" id="systemStatus">
                            <div class="status-indicator"></div>
                            SYSTEM STATUS: ACTIVE - Enterprise AI Engine Running
                        </div>
                    </div>
                    
                    <!-- Advanced Performance Metrics -->
                    <div class="panel">
                        <h3 style="font-size: 28px; font-weight: 800; margin-bottom: 30px; color: var(--text-primary);">Real-time Performance Analytics</h3>
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-title">Current Load</div>
                                <div class="metric-value" id="currentLoad">31,547 VA</div>
                                <div class="metric-subtitle">Volt-Amperes | Real-time</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">AI Efficiency</div>
                                <div class="metric-value" id="systemEfficiency">96.7%</div>
                                <div class="metric-subtitle">Neural optimization active</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Energy Optimized</div>
                                <div class="metric-value" id="energySaved">847.3 kWh</div>
                                <div class="metric-subtitle">Total AI optimization gains</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Cost Reduction</div>
                                <div class="metric-value" id="costSavings">R23,847</div>
                                <div class="metric-subtitle">Financial optimization (ZAR)</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Battery Health</div>
                                <div class="metric-value" id="batteryHealth">98.9%</div>
                                <div class="metric-subtitle">Predictive maintenance</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Power Quality</div>
                                <div class="metric-value" id="powerQuality">99.8%</div>
                                <div class="metric-subtitle">THD & stability analysis</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Uptime</div>
                                <div class="metric-value" id="systemUptime">99.97%</div>
                                <div class="metric-subtitle">Enterprise reliability</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Neural Score</div>
                                <div class="metric-value" id="neuralScore">94.2</div>
                                <div class="metric-subtitle">AI performance index</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Charts Container -->
                    <div class="charts-container">
                        <div class="chart-panel">
                            <div class="chart-title">LSTM Neural Network Predictions</div>
                            <div class="chart-subtitle">Deep Learning Load Forecasting with Confidence Intervals</div>
                            <div class="chart-container">
                                <canvas id="loadChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-panel">
                            <div class="chart-title">Multi-Objective PSO Optimization</div>
                            <div class="chart-subtitle">Particle Swarm Intelligence & Genetic Algorithm Hybrid</div>
                            <div class="chart-container">
                                <canvas id="efficiencyChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Analysis Panel -->
                    <div class="charts-container">
                        <div class="chart-panel">
                            <div class="chart-title">Harmonic Distortion Analysis</div>
                            <div class="chart-subtitle">Real-time THD & Power Quality Assessment</div>
                            <div class="chart-container">
                                <canvas id="harmonicChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-panel">
                            <div class="chart-title">Neural Network Topology</div>
                            <div class="chart-subtitle">Live AI Model Architecture Visualization</div>
                            <div class="chart-container">
                                <canvas id="neuralChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="side-panel">
                    <!-- Advanced AI Engine Panel -->
                    <div class="panel ai-panel">
                        <div class="ai-title">Enterprise AI Engine</div>
                        <div class="ai-metrics">
                            <div class="ai-metric">
                                <div class="ai-metric-label">Neural Accuracy</div>
                                <div class="ai-metric-value" id="modelAccuracy">99.2%</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-label">Prediction Confidence</div>
                                <div class="ai-metric-value" id="predictionConfidence">97.8%</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-label">Learning Rate</div>
                                <div class="ai-metric-value" id="learningRateDisplay">0.001</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-label">Training Samples</div>
                                <div class="ai-metric-value" id="trainingSamples">2.4M</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-label">Model Layers</div>
                                <div class="ai-metric-value" id="modelLayers">47</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-label">Processing Speed</div>
                                <div class="ai-metric-value" id="processingSpeed">847 Hz</div>
                            </div>
                        </div>
                        <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px; line-height: 1.8;">
                            <strong>Active Neural Networks:</strong><br>
                            LSTM Deep Learning | Transformer Architecture<br>
                            PSO Multi-Objective | Genetic Algorithm<br>
                            Fuzzy Logic Control | Reinforcement Learning<br>
                            Anomaly Detection | Pattern Recognition
                        </div>
                    </div>
                    
                    <!-- Advanced Configuration Platform -->
                    <div class="panel advanced-config">
                        <h3 style="color: var(--accent-blue); font-size: 24px; font-weight: 800; margin-bottom: 25px;">Enterprise Configuration</h3>
                        
                        <div class="config-tabs">
                            <div class="config-tab active" onclick="switchConfigTab('system')">System</div>
                            <div class="config-tab" onclick="switchConfigTab('environment')">Environment</div>
                            <div class="config-tab" onclick="switchConfigTab('ai')">AI Engine</div>
                            <div class="config-tab" onclick="switchConfigTab('economic')">Economics</div>
                            <div class="config-tab" onclick="switchConfigTab('advanced')">Advanced</div>
                        </div>
                        
                        <!-- System Configuration -->
                        <div class="config-content active" id="systemConfig">
                            <div class="controls-section">
                                <div class="controls-title">System Parameters</div>
                                
                                <div class="control-group">
                                    <label>Load Pattern Type</label>
                                    <select id="loadPattern">
                                        <option value="office">Corporate Office</option>
                                        <option value="datacenter">Enterprise Data Center</option>
                                        <option value="hospital">Medical Facility</option>
                                        <option value="factory">Manufacturing Plant</option>
                                        <option value="retail">Commercial Retail</option>
                                        <option value="telecom">Telecommunications</option>
                                    </select>
                                </div>
                                
                                <div class="control-group">
                                    <label>Base Load Capacity (VA)</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="baseLoad" min="5000" max="500000" value="31547" step="100">
                                        <span class="range-value" id="baseLoadValue">31,547 VA</span>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>UPS Architecture</label>
                                        <select id="upsMode">
                                            <option value="online">Online (Double Conversion)</option>
                                            <option value="line-interactive">Line Interactive</option>
                                            <option value="standby">Eco-Mode Standby</option>
                                            <option value="parallel">Parallel Redundant</option>
                                        </select>
                                    </div>
                                    <div class="control-group">
                                        <label>Battery Bank Size</label>
                                        <div class="range-container">
                                            <input type="range" class="range-input" id="batteryCount" min="2" max="50" value="12">
                                            <span class="range-value" id="batteryCountValue">12 Units</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Input Voltage (V)</label>
                                        <input type="number" id="inputVoltage" min="110" max="480" step="1" value="230">
                                    </div>
                                    <div class="control-group">
                                        <label>System Frequency (Hz)</label>
                                        <input type="number" id="frequency" min="45" max="65" step="0.1" value="50.0">
                                    </div>
                                </div>
                                
                                <div class="control-group">
                                    <label>Power Factor Optimization</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="powerFactor" min="0.8" max="1.0" step="0.01" value="0.97">
                                        <span class="range-value" id="powerFactorValue">0.97</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Environment Configuration -->
                        <div class="config-content" id="environmentConfig">
                            <div class="controls-section">
                                <div class="controls-title">Environmental Monitoring</div>
                                
                                <div class="control-group">
                                    <label>Ambient Temperature (°C)</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="temperature" min="10" max="45" value="22">
                                        <span class="range-value" id="temperatureValue">22°C</span>
                                    </div>
                                </div>
                                
                                <div class="control-group">
                                    <label>Relative Humidity (%)</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="humidity" min="20" max="95" value="45">
                                        <span class="range-value" id="humidityValue">45%</span>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Grid Stability Index</label>
                                        <select id="gridStability">
                                            <option value="excellent">Excellent (±1%)</option>
                                            <option value="good">Good (±3%)</option>
                                            <option value="fair">Fair (±5%)</option>
                                            <option value="poor">Poor (±10%)</option>
                                            <option value="unstable">Unstable (>10%)</option>
                                        </select>
                                    </div>
                                    <div class="control-group">
                                        <label>Atmospheric Pressure (kPa)</label>
                                        <input type="number" id="ambientPressure" min="90" max="110" step="0.1" value="101.3">
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Altitude (meters)</label>
                                        <input type="number" id="altitude" min="0" max="4000" step="10" value="1750">
                                    </div>
                                    <div class="control-group">
                                        <label>Seismic Activity</label>
                                        <select id="seismicActivity">
                                            <option value="none">None</option>
                                            <option value="low">Low Risk</option>
                                            <option value="moderate">Moderate Risk</option>
                                            <option value="high">High Risk</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI Configuration -->
                        <div class="config-content" id="aiConfig">
                            <div class="controls-section">
                                <div class="controls-title">Neural Network Configuration</div>
                                
                                <div class="control-group">
                                    <label>Learning Rate (Adaptive)</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="learningRate" min="0.00001" max="0.1" step="0.00001" value="0.001">
                                        <span class="range-value" id="learningRateValue">0.001</span>
                                    </div>
                                </div>
                                
                                <div class="control-group">
                                    <label>PSO Swarm Size</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="psoParticles" min="20" max="200" value="75">
                                        <span class="range-value" id="psoParticlesValue">75</span>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>LSTM Hidden Layers</label>
                                        <input type="number" id="lstmLayers" min="3" max="20" value="8">
                                    </div>
                                    <div class="control-group">
                                        <label>Training Epochs</label>
                                        <input type="number" id="trainingEpochs" min="500" max="10000" value="2500">
                                    </div>
                                </div>

                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Dropout Rate</label>
                                        <input type="number" id="dropoutRate" min="0.1" max="0.5" step="0.05" value="0.2">
                                    </div>
                                    <div class="control-group">
                                        <label>Batch Size</label>
                                        <input type="number" id="batchSize" min="16" max="512" step="16" value="64">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Economic Configuration -->
                        <div class="config-content" id="economicConfig">
                            <div class="controls-section">
                                <div class="controls-title">Economic Parameters</div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Electricity Rate (R/kWh)</label>
                                        <input type="number" id="electricityRate" step="0.01" min="1.00" max="15.00" value="3.47">
                                    </div>
                                    <div class="control-group">
                                        <label>Demand Charge (R/kVA)</label>
                                        <input type="number" id="demandCharge" step="0.01" min="50.00" max="1000.00" value="127.50">
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Carbon Factor (kg/kWh)</label>
                                        <input type="number" id="carbonFactor" step="0.01" min="0.1" max="2.5" value="0.95">
                                    </div>
                                    <div class="control-group">
                                        <label>Maintenance Cost (R/year)</label>
                                        <input type="number" id="maintenanceCost" step="100" min="5000" max="200000" value="47500">
                                    </div>
                                </div>

                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Insurance Cost (R/year)</label>
                                        <input type="number" id="insuranceCost" step="100" min="1000" max="50000" value="12750">
                                    </div>
                                    <div class="control-group">
                                        <label>Depreciation Rate (%)</label>
                                        <input type="number" id="depreciationRate" step="0.1" min="5.0" max="25.0" value="12.5">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Configuration -->
                        <div class="config-content" id="advancedConfig">
                            <div class="controls-section">
                                <div class="controls-title">Advanced Features</div>
                                
                                <div class="control-group">
                                    <label>Simulation Speed Multiplier</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="simulationSpeed" min="0.1" max="10.0" step="0.1" value="1.0">
                                        <span class="range-value" id="simulationSpeedValue">1.0x</span>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Data Logging Interval (s)</label>
                                        <input type="number" id="loggingInterval" min="1" max="300" value="5">
                                    </div>
                                    <div class="control-group">
                                        <label>Alert Threshold (%)</label>
                                        <input type="number" id="alertThreshold" min="50" max="95" value="85">
                                    </div>
                                </div>

                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Prediction Horizon (hours)</label>
                                        <input type="number" id="predictionHorizon" min="1" max="168" value="24">
                                    </div>
                                    <div class="control-group">
                                        <label>Auto-Optimization</label>
                                        <select id="autoOptimization">
                                            <option value="disabled">Disabled</option>
                                            <option value="conservative">Conservative</option>
                                            <option value="balanced">Balanced</option>
                                            <option value="aggressive">Aggressive</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Financial Analysis -->
                    <div class="panel financial-panel">
                        <h3 style="font-size: 24px; font-weight: 800; margin-bottom: 25px; color: var(--accent-green);">Enterprise Financial Analysis</h3>
                        <div class="financial-item">
                            <span class="financial-label">Daily Energy Cost:</span>
                            <span class="financial-value cost" id="dailyCost">R2,847.36</span>
                        </div>
                        <div class="financial-item">
                            <span class="financial-label">Monthly Estimate:</span>
                            <span class="financial-value cost" id="monthlyCost">R85,420.80</span>
                        </div>
                        <div class="financial-item">
                            <span class="financial-label">Annual Projection:</span>
                            <span class="financial-value cost" id="annualCost">R1,039,286.40</span>
                        </div>
                        <div class="financial-item">
                            <span class="financial-label">AI Optimization Savings:</span>
                            <span class="financial-value savings" id="potentialSavings">R187,071.55</span>
                        </div>
                        <div class="financial-item">
                            <span class="financial-label">ROI Achievement:</span>
                            <span class="financial-value roi" id="roiPeriod">1.4 years</span>
                        </div>
                        <div class="financial-item">
                            <span class="financial-label">Carbon Footprint:</span>
                            <span class="financial-value" id="carbonFootprint" style="color: #58d68d;">347.2 kg CO₂</span>
                        </div>
                    </div>
                    
                    <!-- Advanced 3D System Topology -->
                    <div class="panel">
                        <h4 style="font-size: 22px; font-weight: 700; margin-bottom: 20px; color: var(--text-primary);">3D Enterprise Topology</h4>
                        <div class="topology-3d" id="topology3d"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Modal System -->
    <div class="modal-overlay" id="simulationModal">
        <div class="modal">
            <h3 style="margin-bottom: 20px; color: var(--accent-blue);">Advanced Simulation Engine</h3>
            <div id="simulationContent">
                <p>Monte Carlo simulation running with 10,000 iterations...</p>
                <div class="loading-state"></div>
            </div>
        </div>
    </div>

    <script>
        // Advanced Global Configuration
        const ENTERPRISE_CONFIG = {
            // System Parameters
            baseLoad: 31547,
            temperature: 22,
            humidity: 45,
            electricityRate: 3.47,
            demandCharge: 127.50,
            carbonFactor: 0.95,
            maintenanceCost: 47500,
            insuranceCost: 12750,
            depreciationRate: 12.5,
            powerFactor: 0.97,
            inputVoltage: 230,
            frequency: 50.0,
            batteryCount: 12,
            loadPattern: 'office',
            upsMode: 'online',
            gridStability: 'excellent',
            ambientPressure: 101.3,
            altitude: 1750,
            seismicActivity: 'low',
            
            // AI Parameters
            learningRate: 0.001,
            psoParticles: 75,
            lstmLayers: 8,
            trainingEpochs: 2500,
            dropoutRate: 0.2,
            batchSize: 64,
            
            // Advanced Parameters
            simulationSpeed: 1.0,
            loggingInterval: 5,
            alertThreshold: 85,
            predictionHorizon: 24,
            autoOptimization: 'balanced'
        };

        // Advanced State Management
        let systemState = {
            active: true,
            aiLearningMode: false,
            simulationRunning: false,
            currentTime: 0,
            totalRuntime: 0,
            lastOptimization: Date.now(),
            performanceHistory: [],
            alerts: [],
            predictions: []
        };

        // Advanced Data Structures
        let chartInstances = {};
        let scene, camera, renderer, controls;
        let upsComponents = {};
        let neuralNetwork = null;
        let optimizationEngine = null;

        // Advanced Time Series Data
        let timeSeriesData = {
            timestamps: [],
            loadData: [],
            efficiencyData: [],
            harmonicData: [],
            temperatureData: [],
            predictions: [],
            confidenceIntervals: []
        };

        // Neural Network Simulation
        class EnterpriseNeuralNetwork {
            constructor(layers, learningRate) {
                this.layers = layers;
                this.learningRate = learningRate;
                this.weights = this.initializeWeights();
                this.training = false;
                this.accuracy = 0.992;
                this.loss = 0.0045;
            }

            initializeWeights() {
                const weights = [];
                for (let i = 0; i < this.layers.length - 1; i++) {
                    const layerWeights = [];
                    for (let j = 0; j < this.layers[i]; j++) {
                        const neuronWeights = [];
                        for (let k = 0; k < this.layers[i + 1]; k++) {
                            neuronWeights.push(Math.random() * 2 - 1);
                        }
                        layerWeights.push(neuronWeights);
                    }
                    weights.push(layerWeights);
                }
                return weights;
            }

            predict(input) {
                // Simplified forward propagation
                let activations = input;
                for (let i = 0; i < this.weights.length; i++) {
                    const newActivations = [];
                    for (let j = 0; j < this.weights[i][0].length; j++) {
                        let sum = 0;
                        for (let k = 0; k < activations.length; k++) {
                            sum += activations[k] * this.weights[i][k][j];
                        }
                        newActivations.push(Math.tanh(sum)); // Tanh activation
                    }
                    activations = newActivations;
                }
                return activations[0];
            }

            train(data) {
                this.training = true;
                // Simulate training process
                setTimeout(() => {
                    this.accuracy = Math.min(0.999, this.accuracy + Math.random() * 0.001);
                    this.loss = Math.max(0.001, this.loss - Math.random() * 0.0001);
                    this.training = false;
                }, 2000);
            }
        }

        // Particle Swarm Optimization
        class ParticleSwarmOptimizer {
            constructor(particleCount, dimensions) {
                this.particleCount = particleCount;
                this.dimensions = dimensions;
                this.particles = this.initializeParticles();
                this.globalBest = { position: null, fitness: -Infinity };
            }

            initializeParticles() {
                const particles = [];
                for (let i = 0; i < this.particleCount; i++) {
                    particles.push({
                        position: Array(this.dimensions).fill().map(() => Math.random()),
                        velocity: Array(this.dimensions).fill().map(() => Math.random() * 0.1),
                        personalBest: { position: null, fitness: -Infinity }
                    });
                }
                return particles;
            }

            optimize(fitnessFunction) {
                // Update particles and find optimal solution
                this.particles.forEach(particle => {
                    const fitness = fitnessFunction(particle.position);
                    if (fitness > particle.personalBest.fitness) {
                        particle.personalBest = { position: [...particle.position], fitness };
                    }
                    if (fitness > this.globalBest.fitness) {
                        this.globalBest = { position: [...particle.position], fitness };
                    }
                });
                
                return this.globalBest;
            }
        }

        // Advanced Loading System
        function initializeEnterpriseSystem() {
            const loadingSteps = [
                { text: 'Initializing core systems...', duration: 500 },
                { text: 'Loading neural networks...', duration: 800 },
                { text: 'Configuring optimization engines...', duration: 600 },
                { text: 'Establishing secure connections...', duration: 700 },
                { text: 'Calibrating sensors...', duration: 400 },
                { text: 'Activating AI modules...', duration: 900 },
                { text: 'System ready for enterprise operations...', duration: 300 }
            ];

            let currentStep = 0;
            const progressBar = document.getElementById('loadingProgress');
            const statusText = document.getElementById('loadingStatus');

            function executeStep() {
                if (currentStep < loadingSteps.length) {
                    const step = loadingSteps[currentStep];
                    statusText.textContent = step.text;
                    progressBar.style.width = `${((currentStep + 1) / loadingSteps.length) * 100}%`;
                    
                    setTimeout(() => {
                        currentStep++;
                        executeStep();
                    }, step.duration);
                } else {
                    // Initialize neural network and optimization
                    neuralNetwork = new EnterpriseNeuralNetwork([10, 20, 15, 10, 1], ENTERPRISE_CONFIG.learningRate);
                    optimizationEngine = new ParticleSwarmOptimizer(ENTERPRISE_CONFIG.psoParticles, 5);
                    
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        document.getElementById('loginOverlay').style.display = 'flex';
                        initializeConfigInputs();
                        generateInitialData();
                    }, 1000);
                }
            }

            executeStep();
        }

        // Advanced Login System
        document.addEventListener('DOMContentLoaded', function() {
            initializeEnterpriseSystem();
            
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value.trim();
                    
                    if (username === 'admin' && password === 'enterprise2024') {
                        document.getElementById('loginOverlay').style.display = 'none';
                        document.getElementById('mainDashboard').style.display = 'block';
                        showAdvancedNotification('Enterprise System Activated - Welcome Administrator', 'success');
                        initializeEnterpriseDashboard();
                    } else {
                        document.getElementById('loginError').textContent = 'Access Denied - Invalid Enterprise Credentials';
                        showAdvancedNotification('Authentication Failed - Security Protocol Activated', 'error');
                    }
                });
            }
        });

        // Generate Initial Realistic Data
        function generateInitialData() {
            const now = Date.now();
            for (let i = 100; i >= 0; i--) {
                const timestamp = new Date(now - i * 60000); // 1-minute intervals
                const hours = timestamp.getHours();
                
                // Realistic load patterns based on time of day
                const baseLoad = ENTERPRISE_CONFIG.baseLoad;
                const timeVariation = Math.sin((hours / 24) * 2 * Math.PI) * baseLoad * 0.4;
                const businessHours = (hours >= 7 && hours <= 19) ? 1.3 : 0.7;
                const randomVariation = (Math.random() - 0.5) * baseLoad * 0.08;
                const load = Math.max(5000, baseLoad * businessHours + timeVariation + randomVariation);
                
                // Advanced efficiency calculation
                const tempEffect = Math.pow((ENTERPRISE_CONFIG.temperature - 25) / 10, 2) * -2;
                const humidityEffect = Math.abs(ENTERPRISE_CONFIG.humidity - 50) * -0.05;
                const efficiency = Math.min(99.9, Math.max(85, 96.5 + tempEffect + humidityEffect + (Math.random() - 0.5) * 1.5));
                
                // Harmonic distortion analysis
                const harmonic = 2.5 + Math.sin(i * 0.1) * 0.8 + Math.random() * 0.5;
                
                timeSeriesData.timestamps.push(timestamp);
                timeSeriesData.loadData.push(load);
                timeSeriesData.efficiencyData.push(efficiency);
                timeSeriesData.harmonicData.push(harmonic);
                timeSeriesData.temperatureData.push(ENTERPRISE_CONFIG.temperature + (Math.random() - 0.5) * 2);
            }

            // Generate predictions using neural network
            generatePredictions();
        }

        // Generate AI Predictions
        function generatePredictions() {
            const lastLoad = timeSeriesData.loadData[timeSeriesData.loadData.length - 1];
            const trend = (timeSeriesData.loadData[timeSeriesData.loadData.length - 1] - 
                          timeSeriesData.loadData[timeSeriesData.loadData.length - 10]) / 10;
            
            for (let i = 1; i <= 24; i++) { // 24-hour prediction
                const prediction = neuralNetwork.predict([
                    lastLoad / 100000,
                    trend / 1000,
                    ENTERPRISE_CONFIG.temperature / 50,
                    ENTERPRISE_CONFIG.humidity / 100,
                    Math.sin(i * Math.PI / 12) // Time cycle
                ]) * 100000;
                
                timeSeriesData.predictions.push(Math.max(5000, prediction));
                
                // Confidence intervals
                const confidence = neuralNetwork.accuracy * 100;
                timeSeriesData.confidenceIntervals.push({
                    upper: prediction * (1 + (100 - confidence) / 200),
                    lower: prediction * (1 - (100 - confidence) / 200)
                });
            }
        }

        // Initialize Enterprise Dashboard
        function initializeEnterpriseDashboard() {
            try {
                initializeAdvancedCharts();
                initialize3DTopology();
                startEnterpriseSimulation();
                setupRealTimeUpdates();
            } catch (error) {
                console.error('Dashboard initialization error:', error);
                showAdvancedNotification('Some advanced features may be limited', 'warning');
            }
        }

        // Advanced Chart Initialization
        function initializeAdvancedCharts() {
            // Load Prediction Chart with Confidence Intervals
            const loadCtx = document.getElementById('loadChart');
            if (loadCtx && typeof Chart !== 'undefined') {
                chartInstances.loadChart = new Chart(loadCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: timeSeriesData.timestamps.map(t => t.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'})),
                        datasets: [{
                            label: 'Actual Load (VA)',
                            data: timeSeriesData.loadData,
                            borderColor: '#5dade2',
                            backgroundColor: 'rgba(93, 173, 226, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 2,
                            borderWidth: 3
                        }, {
                            label: 'AI Prediction',
                            data: [...Array(timeSeriesData.loadData.length - 24).fill(null), ...timeSeriesData.predictions],
                            borderColor: '#f093fb',
                            backgroundColor: 'rgba(240, 147, 251, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 2,
                            borderWidth: 2,
                            borderDash: [5, 5]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#ecf0f1', font: { weight: 'bold', size: 14 } }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: { display: true, text: 'Load (VA)', color: '#ecf0f1', font: { weight: 'bold', size: 16 } },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#bdc3c7', font: { weight: '500' } }
                            },
                            x: {
                                title: { display: true, text: 'Time', color: '#ecf0f1', font: { weight: 'bold', size: 16 } },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#bdc3c7', font: { weight: '500' } }
                            }
                        }
                    }
                });
            }

            // Efficiency Optimization Chart
            const effCtx = document.getElementById('efficiencyChart');
            if (effCtx && typeof Chart !== 'undefined') {
                chartInstances.efficiencyChart = new Chart(effCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: timeSeriesData.timestamps.map(t => t.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'})),
                        datasets: [{
                            label: 'System Efficiency (%)',
                            data: timeSeriesData.efficiencyData,
                            borderColor: '#58d68d',
                            backgroundColor: 'rgba(88, 214, 141, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2,
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#ecf0f1', font: { weight: 'bold', size: 14 } }
                            }
                        },
                        scales: {
                            y: {
                                min: 85, max: 100,
                                title: { display: true, text: 'Efficiency (%)', color: '#ecf0f1', font: { weight: 'bold', size: 16 } },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#bdc3c7', font: { weight: '500' } }
                            },
                            x: {
                                title: { display: true, text: 'Time', color: '#ecf0f1', font: { weight: 'bold', size: 16 } },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#bdc3c7', font: { weight: '500' } }
                            }
                        }
                    }
                });
            }

            // Harmonic Analysis Chart
            const harmonicCtx = document.getElementById('harmonicChart');
            if (harmonicCtx && typeof Chart !== 'undefined') {
                chartInstances.harmonicChart = new Chart(harmonicCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Fundamental', '3rd', '5th', '7th', '9th', '11th', '13th'],
                        datasets: [{
                            label: 'Harmonic Content (%)',
                            data: [100, 2.1, 1.8, 1.2, 0.9, 0.6, 0.4],
                            backgroundColor: [
                                '#58d68d',
                                '#f093fb',
                                '#5dade2',
                                '#f7dc6f',
                                '#bb8fce',
                                '#ec7063',
                                '#85c1e9'
                            ],
                            borderWidth: 2,
                            borderColor: '#ecf0f1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#ecf0f1', font: { weight: 'bold', size: 14 } }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Magnitude (%)', color: '#ecf0f1', font: { weight: 'bold', size: 16 } },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#bdc3c7', font: { weight: '500' } }
                            },
                            x: {
                                title: { display: true, text: 'Harmonic Order', color: '#ecf0f1', font: { weight: 'bold', size: 16 } },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#bdc3c7', font: { weight: '500' } }
                            }
                        }
                    }
                });
            }

            // Neural Network Visualization
            const neuralCtx = document.getElementById('neuralChart');
            if (neuralCtx) {
                drawNeuralNetwork(neuralCtx);
            }
        }

        // Draw Neural Network Topology
        function drawNeuralNetwork(canvas) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, width, height);
            
            const layers = [10, 20, 15, 10, 1];
            const layerWidth = width / (layers.length + 1);
            
            // Draw connections
            ctx.strokeStyle = 'rgba(93, 173, 226, 0.3)';
            ctx.lineWidth = 1;
            
            for (let l = 0; l < layers.length - 1; l++) {
                const currentLayerX = (l + 1) * layerWidth;
                const nextLayerX = (l + 2) * layerWidth;
                
                for (let i = 0; i < Math.min(layers[l], 10); i++) {
                    for (let j = 0; j < Math.min(layers[l + 1], 10); j++) {
                        const y1 = (height / (Math.min(layers[l], 10) + 1)) * (i + 1);
                        const y2 = (height / (Math.min(layers[l + 1], 10) + 1)) * (j + 1);
                        
                        ctx.beginPath();
                        ctx.moveTo(currentLayerX, y1);
                        ctx.lineTo(nextLayerX, y2);
                        ctx.stroke();
                    }
                }
            }
            
            // Draw neurons
            for (let l = 0; l < layers.length; l++) {
                const x = (l + 1) * layerWidth;
                const neuronsToShow = Math.min(layers[l], 10);
                
                for (let i = 0; i < neuronsToShow; i++) {
                    const y = (height / (neuronsToShow + 1)) * (i + 1);
                    
                    // Neuron activation (simulated)
                    const activation = Math.sin(Date.now() * 0.001 + l + i) * 0.5 + 0.5;
                    
                    ctx.fillStyle = `hsl(${200 + activation * 60}, 70%, ${50 + activation * 30}%)`;
                    ctx.beginPath();
                    ctx.arc(x, y, 8, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    ctx.strokeStyle = '#ecf0f1';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
            
            // Layer labels
            ctx.fillStyle = '#ecf0f1';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            const labels = ['Input', 'Hidden 1', 'Hidden 2', 'Output', 'Result'];
            for (let l = 0; l < layers.length; l++) {
                ctx.fillText(labels[l], (l + 1) * layerWidth, height - 10);
            }
        }

        // Advanced 3D Topology System
        function initialize3DTopology() {
            if (typeof THREE === 'undefined') {
                console.warn('Three.js not available - using 2D fallback');
                init2DTopologyFallback();
                return;
            }

            try {
                const container = document.getElementById('topology3d');
                if (!container) return;

                container.innerHTML = '';

                // Scene setup
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x0a0a1a);
                
                // Add fog for depth
                scene.fog = new THREE.Fog(0x0a0a1a, 50, 200);

                // Camera setup
                camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                camera.position.set(20, 15, 20);

                // Renderer setup
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                renderer.outputEncoding = THREE.sRGBEncoding;
                container.appendChild(renderer.domElement);

                // Enhanced lighting system
                const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                directionalLight.position.set(-10, 10, 5);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                scene.add(directionalLight);

                // Multiple colored point lights
                const pointLight1 = new THREE.PointLight(0x667eea, 0.8, 50);
                pointLight1.position.set(10, 10, 10);
                scene.add(pointLight1);

                const pointLight2 = new THREE.PointLight(0xf093fb, 0.6, 30);
                pointLight2.position.set(-10, 5, -10);
                scene.add(pointLight2);

                // Create enterprise UPS system
                createEnterpriseUPSSystem();

                // Create data center environment
                createDataCenterEnvironment();

                // Add orbit controls if available
                if (typeof THREE.OrbitControls !== 'undefined') {
                    controls = new THREE.OrbitControls(camera, renderer.domElement);
                    controls.enableDamping = true;
                    controls.dampingFactor = 0.05;
                    controls.enableZoom = true;
                    controls.autoRotate = true;
                    controls.autoRotateSpeed = 0.5;
                }

                // Animation loop
                function animate() {
                    requestAnimationFrame(animate);

                    if (controls) {
                        controls.update();
                    }

                    // Animate UPS components
                    animateUPSComponents();

                    // Update particle systems
                    updateParticleSystems();

                    renderer.render(scene, camera);
                }
                animate();

                // Handle resize
                window.addEventListener('resize', () => {
                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    camera.aspect = width / height;
                    camera.updateProjectionMatrix();
                    renderer.setSize(width, height);
                });

                console.log('Advanced 3D topology initialized successfully');

            } catch (error) {
                console.error('3D initialization failed:', error);
                init2DTopologyFallback();
            }
        }

        // Create Enterprise UPS System
        function createEnterpriseUPSSystem() {
            const upsGroup = new THREE.Group();
            upsGroup.name = 'upsSystem';

            // Main UPS chassis with advanced materials
            const chassisGeometry = new THREE.BoxGeometry(8, 4, 3);
            const chassisMaterial = new THREE.MeshPhongMaterial({
                color: 0x2c3e50,
                shininess: 100,
                specular: 0x111111
            });
            const chassis = new THREE.Mesh(chassisGeometry, chassisMaterial);
            chassis.position.set(0, 2, 0);
            chassis.castShadow = true;
            chassis.receiveShadow = true;
            upsGroup.add(chassis);

            // Control panel with glass effect
            const panelGeometry = new THREE.BoxGeometry(2, 1.5, 0.1);
            const panelMaterial = new THREE.MeshPhongMaterial({
                color: 0x34495e,
                transparent: true,
                opacity: 0.9
            });
            const controlPanel = new THREE.Mesh(panelGeometry, panelMaterial);
            controlPanel.position.set(0, 2.5, 1.55);
            upsGroup.add(controlPanel);

            // Status LEDs with glow effect
            const ledGeometry = new THREE.SphereGeometry(0.1);
            const ledPositions = [-0.6, -0.3, 0, 0.3, 0.6];
            const ledColors = [0x27ae60, 0x27ae60, 0x3498db, 0xf39c12, 0xe74c3c];

            ledPositions.forEach((pos, index) => {
                const ledMaterial = new THREE.MeshBasicMaterial({
                    color: ledColors[index],
                    emissive: ledColors[index],
                    emissiveIntensity: 0.5
                });
                const led = new THREE.Mesh(ledGeometry, ledMaterial);
                led.position.set(pos, 2.8, 1.6);
                upsGroup.add(led);
                upsComponents[`led${index}`] = led;
            });

            // Cooling fans with rotation
            const fanGeometry = new THREE.CylinderGeometry(0.5, 0.5, 0.2, 8);
            const fanMaterial = new THREE.MeshPhongMaterial({ color: 0x7f8c8d });

            for (let i = 0; i < 3; i++) {
                const fan = new THREE.Mesh(fanGeometry, fanMaterial);
                fan.position.set(-2.5 + i * 2.5, 3.5, 0);
                fan.rotation.x = Math.PI / 2;
                upsGroup.add(fan);
                upsComponents[`fan${i}`] = fan;
            }

            // Advanced battery bank
            createBatteryBank(upsGroup);

            // Power distribution units
            createPowerDistribution(upsGroup);

            scene.add(upsGroup);
            upsComponents.mainGroup = upsGroup;
        }

        // Create Battery Bank
        function createBatteryBank(parentGroup) {
            const batteryGroup = new THREE.Group();
            batteryGroup.name = 'batteryBank';

            const batteryGeometry = new THREE.BoxGeometry(1.2, 2.5, 0.8);
            const batteryMaterial = new THREE.MeshPhongMaterial({
                color: 0x27ae60,
                shininess: 80
            });

            const rows = Math.ceil(ENTERPRISE_CONFIG.batteryCount / 6);
            const batteriesPerRow = Math.min(6, ENTERPRISE_CONFIG.batteryCount);

            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < batteriesPerRow; col++) {
                    if (row * batteriesPerRow + col >= ENTERPRISE_CONFIG.batteryCount) break;

                    const battery = new THREE.Mesh(batteryGeometry, batteryMaterial);
                    battery.position.set(
                        -12 + col * 1.5,
                        1.25,
                        -5 + row * 1.5
                    );
                    battery.castShadow = true;

                    // Battery terminals
                    const terminalGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.15);
                    const terminalMaterial = new THREE.MeshPhongMaterial({ color: 0xf1c40f });

                    const posTerminal = new THREE.Mesh(terminalGeometry, terminalMaterial);
                    posTerminal.position.set(-0.3, 1.33, 0);
                    battery.add(posTerminal);

                    const negTerminal = new THREE.Mesh(terminalGeometry, terminalMaterial);
                    negTerminal.position.set(0.3, 1.33, 0);
                    battery.add(negTerminal);

                    batteryGroup.add(battery);
                }
            }

            parentGroup.add(batteryGroup);
            upsComponents.batteryBank = batteryGroup;
        }

        // Create Power Distribution
        function createPowerDistribution(parentGroup) {
            // Input power connections
            const cableGeometry = new THREE.CylinderGeometry(0.1, 0.1, 15);
            const inputCableMaterial = new THREE.MeshPhongMaterial({ color: 0xe74c3c });
            const inputCable = new THREE.Mesh(cableGeometry, inputCableMaterial);
            inputCable.position.set(-10, 2, 0);
            inputCable.rotation.z = Math.PI / 2;
            parentGroup.add(inputCable);

            // Output power connections
            const outputCableMaterial = new THREE.MeshPhongMaterial({ color: 0x27ae60 });
            const outputCable = new THREE.Mesh(cableGeometry, outputCableMaterial);
            outputCable.position.set(10, 2, 0);
            outputCable.rotation.z = Math.PI / 2;
            parentGroup.add(outputCable);

            // Data connections
            const dataCableGeometry = new THREE.CylinderGeometry(0.05, 0.05, 8);
            const dataCableMaterial = new THREE.MeshPhongMaterial({ color: 0x3498db });
            const dataCable = new THREE.Mesh(dataCableGeometry, dataCableMaterial);
            dataCable.position.set(0, 5, 0);
            parentGroup.add(dataCable);
        }

        // Create Data Center Environment
        function createDataCenterEnvironment() {
            // Server racks
            for (let i = 0; i < 4; i++) {
                const rackGeometry = new THREE.BoxGeometry(1, 6, 2);
                const rackMaterial = new THREE.MeshPhongMaterial({ color: 0x2c3e50 });
                const rack = new THREE.Mesh(rackGeometry, rackMaterial);
                rack.position.set(15 + i * 2, 3, -8 + i * 4);
                rack.castShadow = true;
                scene.add(rack);

                // Server lights
                for (let j = 0; j < 10; j++) {
                    const lightGeometry = new THREE.SphereGeometry(0.03);
                    const lightMaterial = new THREE.MeshBasicMaterial({
                        color: Math.random() > 0.5 ? 0x27ae60 : 0x3498db,
                        emissive: Math.random() > 0.5 ? 0x27ae60 : 0x3498db,
                        emissiveIntensity: 0.8
                    });
                    const light = new THREE.Mesh(lightGeometry, lightMaterial);
                    light.position.set(0.4, -2.5 + j * 0.5, 0.9);
                    rack.add(light);
                }
            }

            // Floor
            const floorGeometry = new THREE.PlaneGeometry(50, 30);
            const floorMaterial = new THREE.MeshPhongMaterial({
                color: 0x34495e,
                shininess: 30
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = 0;
            floor.receiveShadow = true;
            scene.add(floor);

            // Ceiling with grid pattern
            const ceilingGeometry = new THREE.PlaneGeometry(50, 30);
            const ceilingMaterial = new THREE.MeshPhongMaterial({
                color: 0x2c3e50,
                transparent: true,
                opacity: 0.3
            });
            const ceiling = new THREE.Mesh(ceilingGeometry, ceilingMaterial);
            ceiling.rotation.x = Math.PI / 2;
            ceiling.position.y = 15;
            scene.add(ceiling);
        }

        // Animate UPS Components
        function animateUPSComponents() {
            const time = Date.now() * 0.001;

            if (upsComponents.mainGroup && systemState.active) {
                // Gentle rotation of main UPS
                upsComponents.mainGroup.rotation.y = Math.sin(time * 0.1) * 0.1;

                // Animate cooling fans
                for (let i = 0; i < 3; i++) {
                    if (upsComponents[`fan${i}`]) {
                        upsComponents[`fan${i}`].rotation.z += 0.2;
                    }
                }

                // Pulsing LEDs
                for (let i = 0; i < 5; i++) {
                    if (upsComponents[`led${i}`]) {
                        const intensity = 0.3 + 0.4 * Math.sin(time * 2 + i * 0.5);
                        upsComponents[`led${i}`].material.emissiveIntensity = intensity;
                    }
                }

                // Battery charge animation
                if (upsComponents.batteryBank) {
                    upsComponents.batteryBank.children.forEach((battery, index) => {
                        const chargeLevel = 0.8 + 0.2 * Math.sin(time + index * 0.3);
                        battery.scale.y = chargeLevel;
                    });
                }
            }
        }

        // Update Particle Systems
        function updateParticleSystems() {
            // Power flow particles (simulated)
            const time = Date.now() * 0.001;
            
            // Create flowing energy effect
            if (scene.getObjectByName('energyFlow')) {
                scene.remove(scene.getObjectByName('energyFlow'));
            }

            if (systemState.active) {
                const energyGroup = new THREE.Group();
                energyGroup.name = 'energyFlow';

                for (let i = 0; i < 20; i++) {
                    const particleGeometry = new THREE.SphereGeometry(0.05);
                    const particleMaterial = new THREE.MeshBasicMaterial({
                        color: 0x58d68d,
                        emissive: 0x58d68d,
                        emissiveIntensity: 0.8
                    });
                    const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                    
                    const flow = (time * 2 + i * 0.1) % 1;
                    particle.position.set(
                        -15 + flow * 30,
                        2 + Math.sin(time * 3 + i) * 0.5,
                        Math.sin(time + i) * 2
                    );
                    
                    energyGroup.add(particle);
                }

                scene.add(energyGroup);
            }
        }

        // 2D Topology Fallback
        function init2DTopologyFallback() {
            const container = document.getElementById('topology3d');
            if (!container) return;

            container.innerHTML = `
                <canvas id="topology2d" style="width: 100%; height: 100%;"></canvas>
            `;

            const canvas = document.getElementById('topology2d');
            const ctx = canvas.getContext('2d');
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            function draw2DSystem() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const time = Date.now() * 0.003;

                // Draw UPS main unit
                ctx.fillStyle = '#2c3e50';
                ctx.fillRect(centerX - 60, centerY - 40, 120, 80);
                
                ctx.strokeStyle = '#34495e';
                ctx.lineWidth = 3;
                ctx.strokeRect(centerX - 60, centerY - 40, 120, 80);

                // UPS label
                ctx.fillStyle = '#ecf0f1';
                ctx.font = 'bold 16px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('ENTERPRISE UPS', centerX, centerY + 5);

                // Status LEDs
                const ledColors = ['#27ae60', '#27ae60', '#3498db', '#f39c12', '#e74c3c'];
                for (let i = 0; i < 5; i++) {
                    const intensity = 0.5 + 0.3 * Math.sin(time + i * 0.5);
                    const x = centerX - 40 + i * 20;
                    const y = centerY - 60;

                    ctx.shadowColor = ledColors[i];
                    ctx.shadowBlur = 15 * intensity;
                    ctx.fillStyle = ledColors[i];
                    ctx.beginPath();
                    ctx.arc(x, y, 8, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }

                // Battery bank
                const batteryCount = ENTERPRISE_CONFIG.batteryCount;
                const startX = centerX - (batteryCount * 15) / 2;
                for (let i = 0; i < batteryCount; i++) {
                    const x = startX + i * 15;
                    const y = centerY + 80;
                    const charge = 0.8 + 0.2 * Math.sin(time + i * 0.3);

                    ctx.fillStyle = '#27ae60';
                    ctx.fillRect(x - 5, y, 10, 30);
                    
                    ctx.fillStyle = '#2ecc71';
                    ctx.fillRect(x - 4, y + 30 - (28 * charge), 8, 28 * charge);
                }

                // Power flow animation
                const flowOffset = (time * 50) % 40;
                ctx.strokeStyle = '#58d68d';
                ctx.lineWidth = 3;
                ctx.setLineDash([8, 8]);
                ctx.lineDashOffset = -flowOffset;

                // Input line
                ctx.beginPath();
                ctx.moveTo(50, centerY);
                ctx.lineTo(centerX - 60, centerY);
                ctx.stroke();

                // Output line
                ctx.beginPath();
                ctx.moveTo(centerX + 60, centerY);
                ctx.lineTo(canvas.width - 50, centerY);
                ctx.stroke();

                // Labels
                ctx.setLineDash([]);
                ctx.fillStyle = '#ecf0f1';
                ctx.font = '14px Inter';
                ctx.fillText('GRID INPUT', 100, centerY - 20);
                ctx.fillText('LOAD OUTPUT', canvas.width - 100, centerY - 20);
                ctx.fillText('BATTERY BANK', centerX, centerY + 140);

                // Performance metrics
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(20, 20, 250, 150);
                
                ctx.fillStyle = '#ecf0f1';
                ctx.font = 'bold 14px Inter';
                ctx.textAlign = 'left';
                ctx.fillText('REAL-TIME METRICS', 30, 45);

                const metrics = [
                    `Load: ${document.getElementById('currentLoad')?.textContent || 'N/A'}`,
                    `Efficiency: ${document.getElementById('systemEfficiency')?.textContent || 'N/A'}`,
                    `Battery: ${document.getElementById('batteryHealth')?.textContent || 'N/A'}`,
                    `Neural Score: ${document.getElementById('neuralScore')?.textContent || 'N/A'}`,
                    `Uptime: ${document.getElementById('systemUptime')?.textContent || 'N/A'}`
                ];

                ctx.font = '12px Inter';
                metrics.forEach((metric, index) => {
                    ctx.fillText(metric, 30, 70 + index * 20);
                });

                if (systemState.active) {
                    requestAnimationFrame(draw2DSystem);
                }
            }

            draw2DSystem();
        }

        // Configuration Input Handlers
        function initializeConfigInputs() {
            const inputMappings = [
                { id: 'baseLoad', property: 'baseLoad', display: 'baseLoadValue', formatter: (v) => `${v.toLocaleString()} VA` },
                { id: 'temperature', property: 'temperature', display: 'temperatureValue', formatter: (v) => `${v}°C` },
                { id: 'humidity', property: 'humidity', display: 'humidityValue', formatter: (v) => `${v}%` },
                { id: 'powerFactor', property: 'powerFactor', display: 'powerFactorValue', formatter: (v) => v.toString() },
                { id: 'batteryCount', property: 'batteryCount', display: 'batteryCountValue', formatter: (v) => `${v} Units` },
                { id: 'learningRate', property: 'learningRate', display: 'learningRateValue', formatter: (v) => v.toString() },
                { id: 'psoParticles', property: 'psoParticles', display: 'psoParticlesValue', formatter: (v) => v.toString() },
                { id: 'simulationSpeed', property: 'simulationSpeed', display: 'simulationSpeedValue', formatter: (v) => `${v}x` }
            ];

            inputMappings.forEach(mapping => {
                const element = document.getElementById(mapping.id);
                if (element) {
                    element.addEventListener('input', function() {
                        const value = parseFloat(this.value) || parseInt(this.value);
                        ENTERPRISE_CONFIG[mapping.property] = value;

                        const displayElement = document.getElementById(mapping.display);
                        if (displayElement) {
                            displayElement.textContent = mapping.formatter(value);
                        }

                        if (mapping.id === 'learningRate') {
                            const learningRateDisplay = document.getElementById('learningRateDisplay');
                            if (learningRateDisplay) learningRateDisplay.textContent = value;
                        }

                        updateSystemConfiguration();
                    });
                }
            });

            // Handle other inputs
            const otherInputs = [
                'electricityRate', 'demandCharge', 'carbonFactor', 'maintenanceCost',
                'insuranceCost', 'depreciationRate', 'inputVoltage', 'frequency',
                'ambientPressure', 'altitude', 'lstmLayers', 'trainingEpochs',
                'dropoutRate', 'batchSize', 'loggingInterval', 'alertThreshold',
                'predictionHorizon'
            ];

            otherInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        ENTERPRISE_CONFIG[id] = parseFloat(this.value) || parseInt(this.value);
                        updateSystemConfiguration();
                    });
                }
            });

            // Handle select elements
            const selectElements = [
                'loadPattern', 'upsMode', 'gridStability', 'seismicActivity', 'autoOptimization'
            ];

            selectElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        ENTERPRISE_CONFIG[id] = this.value;
                        updateSystemConfiguration();
                    });
                }
            });
        }

        // Advanced Configuration Tab Switching
        function switchConfigTab(tabName) {
            document.querySelectorAll('.config-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.config-content').forEach(content => content.classList.remove('active'));

            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            const contentEl = document.getElementById(tabName + 'Config');
            if (contentEl) {
                contentEl.classList.add('active');
            }
        }

        // Advanced Notification System
        function showAdvancedNotification(message, type = 'success') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-weight: 600;">${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: white; cursor: pointer; font-size: 22px; margin-left: 25px; opacity: 0.8;">×</button>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideInRight 0.4s ease-out reverse';
                    setTimeout(() => notification.remove(), 400);
                }
            }, 6000);
        }

        // System Control Functions
        function startSystem() {
            systemState.active = true;
            systemState.totalRuntime = 0;
            
            const statusEl = document.getElementById('systemStatus');
            if (statusEl) {
                statusEl.innerHTML = '<div class="status-indicator"></div>SYSTEM STATUS: ACTIVE - Enterprise AI Engine Running';
                statusEl.style.color = 'var(--accent-green)';
            }

            showAdvancedNotification('Enterprise System Activated - Full AI Optimization Online', 'success');
            startEnterpriseSimulation();
        }

        function stopSystem() {
            systemState.active = false;
            
            const statusEl = document.getElementById('systemStatus');
            if (statusEl) {
                statusEl.innerHTML = '<div class="status-indicator" style="background: var(--danger); box-shadow: 0 0 25px var(--danger);"></div>SYSTEM STATUS: EMERGENCY STOP - All Operations Halted';
                statusEl.style.color = 'var(--danger)';
            }

            showAdvancedNotification('Emergency Stop Activated - System Safely Shutdown', 'warning');
        }

        function toggleAIMode() {
            systemState.aiLearningMode = !systemState.aiLearningMode;
            const btn = event.target;
            
            if (btn) {
                if (systemState.aiLearningMode) {
                    btn.textContent = 'AI Optimization ON';
                    btn.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71, #58d68d)';
                    showAdvancedNotification('Neural Network Optimization Activated', 'success');
                    
                    // Start neural network training
                    if (neuralNetwork) {
                        neuralNetwork.train(timeSeriesData);
                    }
                } else {
                    btn.textContent = 'AI Optimization';
                    btn.style.background = 'linear-gradient(135deg, #9b59b6, #8e44ad, #bb8fce)';
                    showAdvancedNotification('AI Optimization Deactivated', 'info');
                }
            }
        }

        function runSimulation() {
            if (systemState.simulationRunning) return;
            
            systemState.simulationRunning = true;
            showAdvancedNotification('Monte Carlo Simulation Started - 10,000 Iterations', 'info');
            
            const modal = document.getElementById('simulationModal');
            modal.style.display = 'flex';
            
            // Simulate complex analysis
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                
                const content = document.getElementById('simulationContent');
                content.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Monte Carlo Analysis</span>
                            <span>${Math.min(100, progress.toFixed(1))}%</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px;">
                            <div style="width: ${Math.min(100, progress)}%; height: 100%; background: var(--primary-gradient); border-radius: 4px; transition: width 0.3s;"></div>
                        </div>
                    </div>
                    <div style="font-size: 14px; color: var(--text-secondary);">
                        <p>• Risk Analysis: ${(Math.random() * 5 + 95).toFixed(2)}% confidence</p>
                        <p>• Optimization Potential: ${(Math.random() * 10 + 15).toFixed(1)}% efficiency gain</p>
                        <p>• Predicted Savings: R${(Math.random() * 50000 + 150000).toLocaleString()}</p>
                        <p>• System Reliability: ${(Math.random() * 2 + 98).toFixed(3)}%</p>
                    </div>
                `;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        modal.style.display = 'none';
                        systemState.simulationRunning = false;
                        showAdvancedNotification('Simulation Complete - Optimization Recommendations Available', 'success');
                    }, 2000);
                }
            }, 200);
        }

        function performAnalysis() {
            showAdvancedNotification('Deep Learning Analysis Initiated - Processing Historical Data', 'info');
            
            // Simulate deep analysis
            setTimeout(() => {
                const analysis = {
                    efficiency_trend: (Math.random() * 2 + 1).toFixed(2),
                    power_quality: (Math.random() * 1 + 99).toFixed(3),
                    predicted_maintenance: Math.floor(Math.random() * 30 + 60),
                    cost_optimization: (Math.random() * 20 + 10).toFixed(1)
                };
                
                showAdvancedNotification(
                    `Analysis Complete: ${analysis.efficiency_trend}% efficiency trend, ${analysis.cost_optimization}% cost optimization potential`, 
                    'success'
                );
            }, 3000);
        }

        function exportReport() {
            try {
                const reportData = {
                    metadata: {
                        timestamp: new Date().toISOString(),
                        version: "Enterprise v5.0.0",
                        systemStatus: systemState.active ? 'Active' : 'Stopped',
                        reportType: "Enterprise UPS Analysis Report",
                        generatedBy: "Enterprise UPS Management System",
                        totalRuntime: systemState.totalRuntime,
                        aiOptimization: systemState.aiLearningMode
                    },
                    systemConfiguration: { ...ENTERPRISE_CONFIG },
                    currentMetrics: {
                        load: document.getElementById('currentLoad')?.textContent || 'N/A',
                        efficiency: document.getElementById('systemEfficiency')?.textContent || 'N/A',
                        batteryHealth: document.getElementById('batteryHealth')?.textContent || 'N/A',
                        powerQuality: document.getElementById('powerQuality')?.textContent || 'N/A',
                        energySaved: document.getElementById('energySaved')?.textContent || 'N/A',
                        costSavings: document.getElementById('costSavings')?.textContent || 'N/A',
                        uptime: document.getElementById('systemUptime')?.textContent || 'N/A',
                        neuralScore: document.getElementById('neuralScore')?.textContent || 'N/A'
                    },
                    financialAnalysis: {
                        dailyCost: document.getElementById('dailyCost')?.textContent || 'N/A',
                        monthlyCost: document.getElementById('monthlyCost')?.textContent || 'N/A',
                        annualCost: document.getElementById('annualCost')?.textContent || 'N/A',
                        potentialSavings: document.getElementById('potentialSavings')?.textContent || 'N/A',
                        roiPeriod: document.getElementById('roiPeriod')?.textContent || 'N/A',
                        carbonFootprint: document.getElementById('carbonFootprint')?.textContent || 'N/A'
                    },
                    performanceData: {
                        timeSeriesData: timeSeriesData,
                        dataPoints: timeSeriesData.timestamps.length,
                        averageLoad: (timeSeriesData.loadData.reduce((a, b) => a + b, 0) / timeSeriesData.loadData.length).toFixed(2),
                        averageEfficiency: (timeSeriesData.efficiencyData.reduce((a, b) => a + b, 0) / timeSeriesData.efficiencyData.length).toFixed(2)
                    },
                    aiMetrics: {
                        modelAccuracy: neuralNetwork ? neuralNetwork.accuracy : 0.992,
                        modelLoss: neuralNetwork ? neuralNetwork.loss : 0.0045,
                        predictionConfidence: document.getElementById('predictionConfidence')?.textContent || 'N/A',
                        trainingSamples: document.getElementById('trainingSamples')?.textContent || 'N/A',
                        learningRate: ENTERPRISE_CONFIG.learningRate,
                        psoParticles: ENTERPRISE_CONFIG.psoParticles
                    },
                    recommendations: [
                        "Continue current neural network optimization for maximum efficiency",
                        "Schedule predictive maintenance based on AI analysis in 45 days",
                        "Implement load balancing during peak demand periods",
                        "Consider battery bank expansion for improved redundancy",
                        "Optimize power factor correction for 2.3% additional savings"
                    ]
                };

                const reportText = `
ENTERPRISE UPS MANAGEMENT SYSTEM - COMPREHENSIVE ANALYSIS REPORT
Generated: ${new Date().toLocaleString()}
Report ID: ENT-UPS-${Date.now()}
System Version: Enterprise v5.0.0
=====================================================================

EXECUTIVE SUMMARY
System Status: ${systemState.active ? 'OPERATIONAL' : 'OFFLINE'}
Overall Health Score: Excellent (98.7/100)
AI Optimization: ${systemState.aiLearningMode ? 'ACTIVE' : 'STANDBY'}
Current Efficiency: ${reportData.currentMetrics.efficiency}
Neural Performance Score: ${reportData.currentMetrics.neuralScore}
Recommended Action: Continue Current AI-Driven Configuration

ENTERPRISE SYSTEM CONFIGURATION
Base Load Capacity: ${ENTERPRISE_CONFIG.baseLoad.toLocaleString()} VA
UPS Architecture: ${ENTERPRISE_CONFIG.upsMode}
Battery Bank Configuration: ${ENTERPRISE_CONFIG.batteryCount} Units
Power Factor Optimization: ${ENTERPRISE_CONFIG.powerFactor}
Input Voltage: ${ENTERPRISE_CONFIG.inputVoltage}V
System Frequency: ${ENTERPRISE_CONFIG.frequency}Hz
Load Pattern Type: ${ENTERPRISE_CONFIG.loadPattern}

ENVIRONMENTAL MONITORING
Ambient Temperature: ${ENTERPRISE_CONFIG.temperature}°C
Relative Humidity: ${ENTERPRISE_CONFIG.humidity}%
Grid Stability Index: ${ENTERPRISE_CONFIG.gridStability}
Atmospheric Pressure: ${ENTERPRISE_CONFIG.ambientPressure} kPa
Installation Altitude: ${ENTERPRISE_CONFIG.altitude}m
Seismic Risk Level: ${ENTERPRISE_CONFIG.seismicActivity}

CURRENT PERFORMANCE METRICS
Current Load: ${reportData.currentMetrics.load}
System Efficiency: ${reportData.currentMetrics.efficiency}
Battery Health: ${reportData.currentMetrics.batteryHealth}
Power Quality: ${reportData.currentMetrics.powerQuality}
Energy Optimized: ${reportData.currentMetrics.energySaved}
Cost Reduction: ${reportData.currentMetrics.costSavings}
System Uptime: ${reportData.currentMetrics.uptime}
Neural Score: ${reportData.currentMetrics.neuralScore}

ENTERPRISE FINANCIAL ANALYSIS (ZAR)
Daily Energy Cost: ${reportData.financialAnalysis.dailyCost}
Monthly Estimate: ${reportData.financialAnalysis.monthlyCost}
Annual Projection: ${reportData.financialAnalysis.annualCost}
AI Optimization Savings: ${reportData.financialAnalysis.potentialSavings}
ROI Achievement Period: ${reportData.financialAnalysis.roiPeriod}
Carbon Footprint: ${reportData.financialAnalysis.carbonFootprint}

ARTIFICIAL INTELLIGENCE ENGINE STATUS
Neural Network Accuracy: ${(reportData.aiMetrics.modelAccuracy * 100).toFixed(2)}%
Model Loss Function: ${reportData.aiMetrics.modelLoss.toFixed(6)}
Prediction Confidence: ${reportData.aiMetrics.predictionConfidence}
Training Dataset Size: ${reportData.aiMetrics.trainingSamples}
Learning Rate: ${reportData.aiMetrics.learningRate}
PSO Swarm Size: ${reportData.aiMetrics.psoParticles}
LSTM Hidden Layers: ${ENTERPRISE_CONFIG.lstmLayers}
Training Epochs: ${ENTERPRISE_CONFIG.trainingEpochs.toLocaleString()}

PERFORMANCE DATA ANALYTICS
Total Data Points Collected: ${reportData.performanceData.dataPoints.toLocaleString()}
Average Load (24h): ${reportData.performanceData.averageLoad} VA
Average Efficiency (24h): ${reportData.performanceData.averageEfficiency}%
Data Logging Interval: ${ENTERPRISE_CONFIG.loggingInterval} seconds
Prediction Horizon: ${ENTERPRISE_CONFIG.predictionHorizon} hours

AI OPTIMIZATION RECOMMENDATIONS
${reportData.recommendations.map((rec, index) => `${index + 1}. ${rec}`).join('\n')}

DETAILED TECHNICAL DATA
${JSON.stringify(reportData, null, 2)}

=====================================================================
Report Generated by Enterprise UPS Management System v5.0.0
Professional AI-Driven Analytics & Predictive Optimization Platform
© 2024 Advanced Power Management Solutions - All Rights Reserved
`;

                const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Enterprise_UPS_Report_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.txt`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showAdvancedNotification('Enterprise Report Generated Successfully', 'success');

            } catch (error) {
                console.error('Export error:', error);
                showAdvancedNotification('Report Export Failed - Check Console for Details', 'error');
            }
        }

        // Real-time Data Simulation
        function startEnterpriseSimulation() {
            if (systemState.simulationInterval) {
                clearInterval(systemState.simulationInterval);
            }

            systemState.simulationInterval = setInterval(() => {
                updateRealTimeData();
                updateChartsData();
                updateFinancialMetrics();
                updateAIMetrics();
            }, ENTERPRISE_CONFIG.loggingInterval * 1000);
        }

        function updateRealTimeData() {
            if (!systemState.active) return;

            const now = new Date();
            const hours = now.getHours();
            
            // Advanced load calculation
            const baseLoad = ENTERPRISE_CONFIG.baseLoad;
            const timeVariation = Math.sin((hours / 24) * 2 * Math.PI) * baseLoad * 0.35;
            const businessHours = (hours >= 7 && hours <= 19) ? 1.4 : 0.75;
            const weatherEffect = (ENTERPRISE_CONFIG.temperature - 22) * baseLoad * 0.002;
            const randomVariation = (Math.random() - 0.5) * baseLoad * 0.06;
            const currentLoad = Math.max(5000, baseLoad * businessHours + timeVariation + weatherEffect + randomVariation);

            // Advanced efficiency calculation with AI optimization
            const baseEfficiency = 94.5;
            const tempEffect = Math.pow((ENTERPRISE_CONFIG.temperature - 25) / 10, 2) * -1.5;
            const humidityEffect = Math.abs(ENTERPRISE_CONFIG.humidity - 50) * -0.03;
            const aiBoost = systemState.aiLearningMode ? 2.2 : 0;
            const gridEffect = ENTERPRISE_CONFIG.gridStability === 'excellent' ? 1.0 : 
                              ENTERPRISE_CONFIG.gridStability === 'good' ? 0.5 : -0.5;
            const efficiency = Math.min(99.9, Math.max(85, baseEfficiency + tempEffect + humidityEffect + aiBoost + gridEffect + (Math.random() - 0.5) * 1.2));

            // Advanced metrics
            const batteryHealth = Math.max(95, 98.9 - (systemState.totalRuntime * 0.0001) + (Math.random() - 0.5) * 0.2);
            const powerQuality = 99.4 + (Math.random() - 0.5) * 0.8 + (ENTERPRISE_CONFIG.gridStability === 'excellent' ? 0.4 : 0);
            const uptime = Math.min(99.99, 99.50 + (systemState.totalRuntime * 0.0001));
            const neuralScore = 85 + (neuralNetwork ? neuralNetwork.accuracy * 15 : 9.2);

            // Update displays
            document.getElementById('currentLoad').textContent = `${currentLoad.toLocaleString()} VA`;
            document.getElementById('systemEfficiency').textContent = `${efficiency.toFixed(1)}%`;
            document.getElementById('batteryHealth').textContent = `${batteryHealth.toFixed(1)}%`;
            document.getElementById('powerQuality').textContent = `${powerQuality.toFixed(1)}%`;
            document.getElementById('systemUptime').textContent = `${uptime.toFixed(2)}%`;
            document.getElementById('neuralScore').textContent = neuralScore.toFixed(1);

            // Update time series data
            timeSeriesData.timestamps.push(now);
            timeSeriesData.loadData.push(currentLoad);
            timeSeriesData.efficiencyData.push(efficiency);
            timeSeriesData.harmonicData.push(2.5 + Math.sin(systemState.currentTime * 0.1) * 0.8 + Math.random() * 0.5);
            timeSeriesData.temperatureData.push(ENTERPRISE_CONFIG.temperature + (Math.random() - 0.5) * 1.5);

            // Keep only last 100 data points
            if (timeSeriesData.timestamps.length > 100) {
                timeSeriesData.timestamps.shift();
                timeSeriesData.loadData.shift();
                timeSeriesData.efficiencyData.shift();
                timeSeriesData.harmonicData.shift();
                timeSeriesData.temperatureData.shift();
            }

            systemState.currentTime += ENTERPRISE_CONFIG.simulationSpeed;
            systemState.totalRuntime += ENTERPRISE_CONFIG.loggingInterval;
        }

        function updateChartsData() {
            // Update all charts with new data
            Object.values(chartInstances).forEach(chart => {
                if (chart && chart.data) {
                    if (chart === chartInstances.loadChart) {
                        chart.data.labels = timeSeriesData.timestamps.map(t => 
                            t.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'})
                        );
                        chart.data.datasets[0].data = [...timeSeriesData.loadData];
                        chart.update('none');
                    } else if (chart === chartInstances.efficiencyChart) {
                        chart.data.labels = timeSeriesData.timestamps.map(t => 
                            t.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'})
                        );
                        chart.data.datasets[0].data = [...timeSeriesData.efficiencyData];
                        chart.update('none');
                    } else if (chart === chartInstances.harmonicChart) {
                        // Update harmonic data with some variation
                        chart.data.datasets[0].data = [
                            100,
                            2.1 + Math.sin(systemState.currentTime * 0.05) * 0.3,
                            1.8 + Math.sin(systemState.currentTime * 0.03) * 0.2,
                            1.2 + Math.sin(systemState.currentTime * 0.07) * 0.15,
                            0.9 + Math.sin(systemState.currentTime * 0.04) * 0.1,
                            0.6 + Math.sin(systemState.currentTime * 0.06) * 0.08,
                            0.4 + Math.sin(systemState.currentTime * 0.02) * 0.05
                        ];
                        chart.update('none');
                    }
                }
            });

            // Update neural network visualization
            const neuralCanvas = document.getElementById('neuralChart');
            if (neuralCanvas) {
                drawNeuralNetwork(neuralCanvas);
            }
        }

        function updateFinancialMetrics() {
            const currentLoad = timeSeriesData.loadData[timeSeriesData.loadData.length - 1] || ENTERPRISE_CONFIG.baseLoad;
            const realPowerKW = (currentLoad * ENTERPRISE_CONFIG.powerFactor) / 1000;
            
            // Enhanced financial calculations
            const energySaved = (systemState.totalRuntime * 0.15 + Math.random() * 0.8).toFixed(0);
            const costSavings = (energySaved * ENTERPRISE_CONFIG.electricityRate).toFixed(0);
            
            document.getElementById('energySaved').textContent = `${energySaved} kWh`;
            document.getElementById('costSavings').textContent = `R${parseFloat(costSavings).toLocaleString()}`;
            
            // Daily calculations
            const dailyEnergy = realPowerKW * 24;
            const dailyCost = dailyEnergy * ENTERPRISE_CONFIG.electricityRate + 
                            (currentLoad / 1000) * ENTERPRISE_CONFIG.demandCharge / 30;
            const monthlyCost = dailyCost * 30;
            const annualCost = dailyCost * 365;
            const optimizationSavings = annualCost * (systemState.aiLearningMode ? 0.18 : 0.12);
            const roiYears = ((ENTERPRISE_CONFIG.maintenanceCost + ENTERPRISE_CONFIG.insuranceCost + 150000) / optimizationSavings);
            const carbonFootprint = (dailyEnergy * ENTERPRISE_CONFIG.carbonFactor * 30);
            
            document.getElementById('dailyCost').textContent = `R${dailyCost.toLocaleString()}`;
            document.getElementById('monthlyCost').textContent = `R${monthlyCost.toLocaleString()}`;
            document.getElementById('annualCost').textContent = `R${annualCost.toLocaleString()}`;
            document.getElementById('potentialSavings').textContent = `R${optimizationSavings.toLocaleString()}`;
            document.getElementById('roiPeriod').textContent = `${roiYears.toFixed(1)} years`;
            document.getElementById('carbonFootprint').textContent = `${carbonFootprint.toFixed(1)} kg CO₂`;
        }

        function updateAIMetrics() {
            if (neuralNetwork) {
                document.getElementById('modelAccuracy').textContent = `${(neuralNetwork.accuracy * 100).toFixed(1)}%`;
                
                // Simulate training improvements
                if (systemState.aiLearningMode && neuralNetwork.training) {
                    neuralNetwork.accuracy = Math.min(0.999, neuralNetwork.accuracy + Math.random() * 0.0001);
                }
            }
            
            // Update other AI metrics with realistic variations
            const predictionConfidence = (94.2 + Math.sin(systemState.currentTime * 0.02) * 3.5).toFixed(1);
            const trainingSamples = (2.4 + (systemState.totalRuntime / 10000)).toFixed(1);
            const processingSpeed = (847 + Math.sin(systemState.currentTime * 0.05) * 50).toFixed(0);
            
            document.getElementById('predictionConfidence').textContent = `${predictionConfidence}%`;
            document.getElementById('trainingSamples').textContent = `${trainingSamples}M`;
            document.getElementById('processingSpeed').textContent = `${processingSpeed} Hz`;
        }

        function updateSystemConfiguration() {
            showAdvancedNotification('Enterprise Configuration Updated Successfully', 'info');
            
            // Update neural network if learning rate changed
            if (neuralNetwork && ENTERPRISE_CONFIG.learningRate !== neuralNetwork.learningRate) {
                neuralNetwork.learningRate = ENTERPRISE_CONFIG.learningRate;
            }
            
            // Update optimization engine if particle count changed
            if (optimizationEngine && ENTERPRISE_CONFIG.psoParticles !== optimizationEngine.particleCount) {
                optimizationEngine = new ParticleSwarmOptimizer(ENTERPRISE_CONFIG.psoParticles, 5);
            }
            
            // Regenerate predictions if major parameters changed
            generatePredictions();
        }

        function setupRealTimeUpdates() {
            // Start the main simulation
            startEnterpriseSimulation();
            
            // Update neural network visualization periodically
            setInterval(() => {
                const neuralCanvas = document.getElementById('neuralChart');
                if (neuralCanvas) {
                    drawNeuralNetwork(neuralCanvas);
                }
            }, 5000);
            
            // Periodic system health checks
            setInterval(() => {
                if (systemState.active) {
                    performSystemHealthCheck();
                }
            }, 30000);
        }

        function performSystemHealthCheck() {
            const currentEfficiency = parseFloat(document.getElementById('systemEfficiency')?.textContent || '95');
            const batteryHealth = parseFloat(document.getElementById('batteryHealth')?.textContent || '98');
            const powerQuality = parseFloat(document.getElementById('powerQuality')?.textContent || '99');
            
            if (currentEfficiency < ENTERPRISE_CONFIG.alertThreshold) {
                showAdvancedNotification(`Efficiency Alert: ${currentEfficiency}% - Below threshold`, 'warning');
            }
            
            if (batteryHealth < 90) {
                showAdvancedNotification(`Battery Health Warning: ${batteryHealth}% - Maintenance required`, 'warning');
            }
            
            if (powerQuality < 98) {
                showAdvancedNotification(`Power Quality Alert: ${powerQuality}% - Grid issues detected`, 'warning');
            }
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Enterprise UPS Management System v5.0.0 - Initializing...');
        });
    </script>
</body>
</html>