<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced UPS Optimization Dashboard - Professional</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e, #16213e);
            color: #ffffff;
            overflow-x: auto;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20000;
            flex-direction: column;
        }
        
        .loading-text {
            color: #667eea;
            font-size: 1.5rem;
            margin-top: 20px;
            font-weight: 600;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.95), rgba(26, 26, 46, 0.95));
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            min-width: 450px;
        }
        
        .login-title {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        
        .login-subtitle {
            color: #bdc3c7;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .login-input {
            width: 100%;
            padding: 18px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: #ffffff;
            font-size: 16px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.4);
            transform: scale(1.02);
        }
        
        .login-input::placeholder {
            color: rgba(255,255,255,0.6);
        }
        
        .login-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 17px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
        }
        
        .login-error {
            color: #e74c3c;
            margin-top: 15px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .security-notice {
            margin-top: 25px;
            padding: 15px;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
            font-size: 12px;
            color: #ecf0f1;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            text-align: center;
            box-shadow: 0 6px 30px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            font-weight: 400;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 25px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .main-panel, .side-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }
        
        .panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }
        
        .control-panel {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.15), rgba(46, 204, 113, 0.08));
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-start { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; }
        .btn-stop { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .btn-export { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .btn-ai { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .status {
            font-size: 20px;
            font-weight: bold;
            color: #2ecc71;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(39, 174, 96, 0.1);
            border-radius: 12px;
            border-left: 4px solid #27ae60;
        }
        
        .status-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #2ecc71;
            animation: pulse 2s infinite;
            box-shadow: 0 0 15px #2ecc71;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #667eea);
            background-size: 200% 100%;
            animation: gradient-shift 3s ease infinite;
        }
        
        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .metric-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .metric-title {
            font-size: 13px;
            color: #bdc3c7;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 600;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .metric-subtitle {
            font-size: 11px;
            color: #95a5a6;
            font-weight: 500;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .chart-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            padding: 25px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #ecf0f1;
        }
        
        .chart-subtitle {
            font-size: 13px;
            color: #95a5a6;
            margin-bottom: 20px;
        }
        
        .ai-panel {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.15), rgba(142, 68, 173, 0.08));
        }
        
        .ai-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #9b59b6;
        }
        
        .ai-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .ai-metric {
            background: rgba(155, 89, 182, 0.15);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        .ai-metric-label {
            font-size: 12px;
            color: #bdc3c7;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .ai-metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #9b59b6;
        }
        
        .controls-section {
            margin-bottom: 25px;
        }
        
        .controls-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #3498db;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .control-group label {
            font-size: 12px;
            color: #bdc3c7;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .control-group input, .control-group select {
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 14px;
            background: rgba(255,255,255,0.1);
            color: #ffffff;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        
        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.3);
            transform: scale(1.02);
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .range-input {
            flex: 1;
        }
        
        .range-value {
            font-size: 14px;
            color: #3498db;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
            background: rgba(52, 152, 219, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .topology-3d {
            height: 350px;
            background: rgba(0,0,0,0.4);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 18px 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 350px;
            animation: slideIn 0.4s ease-out;
            border-left: 4px solid #ffffff;
        }
        
        .notification.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .advanced-config {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.15), rgba(41, 128, 185, 0.08));
        }
        
        .config-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .config-tab {
            padding: 10px 15px;
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }
        
        .config-tab.active {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            color: #3498db;
        }
        
        .config-content {
            display: none;
        }
        
        .config-content.active {
            display: block;
        }
        
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .error-panel {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px;
            color: #e74c3c;
            display: none;
        }
        
        @media (max-width: 1400px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .charts-container { grid-template-columns: 1fr; }
            .input-group { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .login-container { min-width: 320px; margin: 20px; }
            .header h1 { font-size: 2rem; }
            .container { padding: 15px; }
            .control-buttons { grid-template-columns: 1fr; }
            .metrics-grid { grid-template-columns: 1fr 1fr; }
            .ai-metrics { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading UPS Dashboard...</div>
    </div>

    <!-- Error Panel -->
    <div class="error-panel" id="errorPanel">
        <h3>Failed to Load Required Libraries</h3>
        <p>The dashboard requires Chart.js and Three.js to function properly. Please check your internet connection and refresh the page.</p>
        <button onclick="location.reload()" style="margin-top: 10px; padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer;">Reload Page</button>
    </div>

    <!-- Login Screen -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <h1 class="login-title">Secure Access Portal</h1>
            <p class="login-subtitle">Advanced UPS Optimization Dashboard</p>
            <form id="loginForm">
                <input type="text" class="login-input" id="username" placeholder="Username" required>
                <input type="password" class="login-input" id="password" placeholder="Password" required>
                <button type="submit" class="login-btn">Access Dashboard</button>
            </form>
            <div class="login-error" id="loginError"></div>
            <div class="security-notice">
                <strong>Security Notice:</strong> This system requires valid credentials.<br>
                Demo Access: admin / ups2024
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainDashboard" style="display: none;">
        <div class="header">
            <h1>Advanced UPS Optimization Dashboard</h1>
            <p>Professional AI-Driven Power Management System | Real-time Analytics & Control</p>
        </div>
        
        <div class="container">
            <div class="dashboard-grid">
                <div class="main-panel">
                    <!-- Control Panel -->
                    <div class="panel control-panel">
                        <h3>System Control Center</h3>
                        <div class="control-buttons">
                            <button class="btn btn-start" onclick="startSystem()">Start System</button>
                            <button class="btn btn-stop" onclick="stopSystem()">Stop System</button>
                            <button class="btn btn-export" onclick="exportReport()">Export Report</button>
                            <button class="btn btn-ai" onclick="toggleAIMode()">AI Learning</button>
                        </div>
                        <div class="status" id="systemStatus">
                            <div class="status-indicator"></div>
                            STATUS: ACTIVE - AI Optimization Running
                        </div>
                    </div>
                    
                    <!-- Real-time Metrics -->
                    <div class="panel">
                        <h3>Real-time Performance Metrics</h3>
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-title">Current Load</div>
                                <div class="metric-value" id="currentLoad">31.5 VA</div>
                                <div class="metric-subtitle">Volt-Amperes measurement</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">System Efficiency</div>
                                <div class="metric-value" id="systemEfficiency">93.0%</div>
                                <div class="metric-subtitle">AI-optimized performance</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Energy Saved</div>
                                <div class="metric-value" id="energySaved">5.83 kWh</div>
                                <div class="metric-subtitle">Total optimization gains</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Cost Savings</div>
                                <div class="metric-value" id="costSavings">R12.60</div>
                                <div class="metric-subtitle">Financial benefits (ZAR)</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Battery Health</div>
                                <div class="metric-value" id="batteryHealth">98.2%</div>
                                <div class="metric-subtitle">Predictive maintenance</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Power Quality</div>
                                <div class="metric-value" id="powerQuality">99.7%</div>
                                <div class="metric-subtitle">THD & voltage stability</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Container -->
                    <div class="charts-container">
                        <div class="chart-panel">
                            <div class="chart-title">LSTM Neural Network Predictions</div>
                            <div class="chart-subtitle">Deep Learning Load Forecasting in VA</div>
                            <canvas id="loadChart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-panel">
                            <div class="chart-title">PSO Efficiency Optimization</div>
                            <div class="chart-subtitle">Particle Swarm Optimization Results</div>
                            <canvas id="efficiencyChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="side-panel">
                    <!-- AI Engine Status -->
                    <div class="panel ai-panel">
                        <div class="ai-title">AI Engine Status</div>
                        <div class="ai-metrics">
                            <div class="ai-metric">
                                <div class="ai-metric-label">Model Accuracy</div>
                                <div class="ai-metric-value" id="modelAccuracy">97.8%</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-label">Prediction Confidence</div>
                                <div class="ai-metric-value" id="predictionConfidence">94.2%</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-label">Learning Rate</div>
                                <div class="ai-metric-value" id="learningRateDisplay">0.001</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-label">Training Samples</div>
                                <div class="ai-metric-value" id="trainingSamples">50.2K</div>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: #bdc3c7; margin-bottom: 15px;">
                            <strong>Active Algorithms:</strong><br>
                            LSTM Forecasting | PSO Optimization<br>
                            Fuzzy Logic Control | Anomaly Detection
                        </div>
                    </div>
                    
                    <!-- Advanced Configuration Platform -->
                    <div class="panel advanced-config">
                        <h3 style="color: #3498db;">Advanced Configuration Platform</h3>
                        
                        <div class="config-tabs">
                            <div class="config-tab active" onclick="switchConfigTab('system')">System</div>
                            <div class="config-tab" onclick="switchConfigTab('environment')">Environment</div>
                            <div class="config-tab" onclick="switchConfigTab('ai')">AI Config</div>
                            <div class="config-tab" onclick="switchConfigTab('economic')">Economic</div>
                        </div>
                        
                        <!-- System Configuration -->
                        <div class="config-content active" id="systemConfig">
                            <div class="controls-section">
                                <div class="controls-title">System Parameters</div>
                                
                                <div class="control-group">
                                    <label>Load Pattern</label>
                                    <select id="loadPattern">
                                        <option value="office">Office Building</option>
                                        <option value="datacenter">Data Center</option>
                                        <option value="hospital">Hospital</option>
                                        <option value="factory">Manufacturing</option>
                                        <option value="retail">Retail Store</option>
                                    </select>
                                </div>
                                
                                <div class="control-group">
                                    <label>Base Load (VA)</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="baseLoad" min="1000" max="150000" value="31500" step="100">
                                        <span class="range-value" id="baseLoadValue">31500 VA</span>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>UPS Mode</label>
                                        <select id="upsMode">
                                            <option value="online">Online (Double Conversion)</option>
                                            <option value="line-interactive">Line Interactive</option>
                                            <option value="standby">Standby</option>
                                        </select>
                                    </div>
                                    <div class="control-group">
                                        <label>Battery Count</label>
                                        <div class="range-container">
                                            <input type="range" class="range-input" id="batteryCount" min="1" max="20" value="4">
                                            <span class="range-value" id="batteryCountValue">4 Units</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Input Voltage (V)</label>
                                        <input type="number" id="inputVoltage" min="110" max="480" step="1" value="230">
                                    </div>
                                    <div class="control-group">
                                        <label>Frequency (Hz)</label>
                                        <input type="number" id="frequency" min="45" max="65" step="0.1" value="50.0">
                                    </div>
                                </div>
                                
                                <div class="control-group">
                                    <label>Power Factor</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="powerFactor" min="0.8" max="1.0" step="0.01" value="0.95">
                                        <span class="range-value" id="powerFactorValue">0.95</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Environment Configuration -->
                        <div class="config-content" id="environmentConfig">
                            <div class="controls-section">
                                <div class="controls-title">Environmental Conditions</div>
                                
                                <div class="control-group">
                                    <label>Temperature (°C)</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="temperature" min="15" max="35" value="22">
                                        <span class="range-value" id="temperatureValue">22°C</span>
                                    </div>
                                </div>
                                
                                <div class="control-group">
                                    <label>Humidity (%)</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="humidity" min="30" max="90" value="45">
                                        <span class="range-value" id="humidityValue">45%</span>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Grid Stability</label>
                                        <select id="gridStability">
                                            <option value="stable">Stable</option>
                                            <option value="minor">Minor Fluctuations</option>
                                            <option value="unstable">Unstable</option>
                                            <option value="outage">Simulated Outage</option>
                                        </select>
                                    </div>
                                    <div class="control-group">
                                        <label>Ambient Pressure (kPa)</label>
                                        <input type="number" id="ambientPressure" min="95" max="105" step="0.1" value="101.3">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI Configuration -->
                        <div class="config-content" id="aiConfig">
                            <div class="controls-section">
                                <div class="controls-title">AI Model Configuration</div>
                                
                                <div class="control-group">
                                    <label>Learning Rate</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="learningRate" min="0.0001" max="0.1" step="0.0001" value="0.001">
                                        <span class="range-value" id="learningRateValue">0.001</span>
                                    </div>
                                </div>
                                
                                <div class="control-group">
                                    <label>PSO Particles</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" id="psoParticles" min="10" max="50" value="30">
                                        <span class="range-value" id="psoParticlesValue">30</span>
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>LSTM Layers</label>
                                        <input type="number" id="lstmLayers" min="2" max="5" value="3">
                                    </div>
                                    <div class="control-group">
                                        <label>Training Epochs</label>
                                        <input type="number" id="trainingEpochs" min="100" max="5000" value="1000">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Economic Configuration -->
                        <div class="config-content" id="economicConfig">
                            <div class="controls-section">
                                <div class="controls-title">Economic Parameters</div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Electricity Rate (R/kWh)</label>
                                        <input type="number" id="electricityRate" step="0.01" min="0.50" max="10.00" value="2.50">
                                    </div>
                                    <div class="control-group">
                                        <label>Demand Charge (R/kVA)</label>
                                        <input type="number" id="demandCharge" step="0.01" min="0.00" max="500.00" value="85.50">
                                    </div>
                                </div>
                                
                                <div class="input-group">
                                    <div class="control-group">
                                        <label>Carbon Factor (kg/kWh)</label>
                                        <input type="number" id="carbonFactor" step="0.01" min="0.1" max="2.0" value="0.85">
                                    </div>
                                    <div class="control-group">
                                        <label>Maintenance Cost (R/year)</label>
                                        <input type="number" id="maintenanceCost" step="1" min="0" max="50000" value="12500">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Calculations -->
                    <div class="panel">
                        <h3>Live Financial Analysis (ZAR)</h3>
                        <div style="font-size: 13px; color: #bdc3c7; line-height: 2;">
                            • Daily Energy Cost: <span id="dailyCost" style="color: #3498db; font-weight: bold;">R156.20</span><br>
                            • Monthly Estimate: <span id="monthlyCost" style="color: #3498db; font-weight: bold;">R4,686.00</span><br>
                            • Annual Projection: <span id="annualCost" style="color: #3498db; font-weight: bold;">R56,232.00</span><br>
                            • Potential Savings: <span id="potentialSavings" style="color: #27ae60; font-weight: bold;">R8,435.00</span><br>
                            • ROI Period: <span id="roiPeriod" style="color: #e67e22; font-weight: bold;">2.3 years</span>
                        </div>
                    </div>
                    
                    <!-- 3D System Topology -->
                    <div class="panel">
                        <h4>3D System Topology</h4>
                        <div class="topology-3d" id="topology3d"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check for library dependencies
        function checkDependencies() {
            let dependencies = true;
            
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded');
                dependencies = false;
            }
            
            if (typeof THREE === 'undefined') {
                console.error('Three.js not loaded');
                dependencies = false;
            }
            
            if (!dependencies) {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('errorPanel').style.display = 'block';
                return false;
            }
            
            return true;
        }

        // Advanced Global Variables
        let systemActive = true;
        let aiLearningMode = false;
        let loadChart, efficiencyChart;
        let currentTime = 0;
        let simulationInterval;
        let scene, camera, renderer, upsComponents = {};
        let loadData = [], efficiencyData = [], timeLabels = [];
        
        // Configuration Variables
        let config = {
            baseLoad: 31500, // VA
            temperature: 22,
            humidity: 45,
            electricityRate: 2.50,
            demandCharge: 85.50,
            carbonFactor: 0.85,
            maintenanceCost: 12500,
            powerFactor: 0.95,
            inputVoltage: 230,
            frequency: 50.0,
            batteryCount: 4,
            loadPattern: 'office',
            upsMode: 'online',
            gridStability: 'stable',
            ambientPressure: 101.3,
            learningRate: 0.001,
            psoParticles: 30,
            lstmLayers: 3,
            trainingEpochs: 1000
        };

        // Enhanced Login System
        document.addEventListener('DOMContentLoaded', function() {
            // Check dependencies first
            setTimeout(() => {
                if (checkDependencies()) {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('loginOverlay').style.display = 'flex';
                    initializeConfigInputs();
                }
            }, 1500);
            
            const loginForm = document.getElementById('loginForm');
            
            if (loginForm) {
                loginForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value.trim();
                    
                    // Enhanced security check
                    if (username === 'admin' && password === 'ups2024') {
                        document.getElementById('loginOverlay').style.display = 'none';
                        document.getElementById('mainDashboard').style.display = 'block';
                        showNotification('Welcome to Advanced UPS Dashboard!', 'success');
                        initializeAll();
                    } else {
                        document.getElementById('loginError').textContent = 'Access Denied - Invalid Credentials';
                        showNotification('Authentication Failed', 'error');
                    }
                });
            }
        });

        // Initialize all configuration inputs with event listeners
        function initializeConfigInputs() {
            // System Configuration
            const baseLoadEl = document.getElementById('baseLoad');
            if (baseLoadEl) {
                baseLoadEl.addEventListener('input', function() {
                    config.baseLoad = parseInt(this.value);
                    const valueEl = document.getElementById('baseLoadValue');
                    if (valueEl) valueEl.textContent = config.baseLoad + ' VA';
                    updateSimulation();
                });
            }
            
            const temperatureEl = document.getElementById('temperature');
            if (temperatureEl) {
                temperatureEl.addEventListener('input', function() {
                    config.temperature = parseInt(this.value);
                    const valueEl = document.getElementById('temperatureValue');
                    if (valueEl) valueEl.textContent = config.temperature + '°C';
                    updateSimulation();
                });
            }
            
            const humidityEl = document.getElementById('humidity');
            if (humidityEl) {
                humidityEl.addEventListener('input', function() {
                    config.humidity = parseInt(this.value);
                    const valueEl = document.getElementById('humidityValue');
                    if (valueEl) valueEl.textContent = config.humidity + '%';
                    updateSimulation();
                });
            }
            
            const powerFactorEl = document.getElementById('powerFactor');
            if (powerFactorEl) {
                powerFactorEl.addEventListener('input', function() {
                    config.powerFactor = parseFloat(this.value);
                    const valueEl = document.getElementById('powerFactorValue');
                    if (valueEl) valueEl.textContent = config.powerFactor;
                    updateSimulation();
                });
            }
            
            const batteryCountEl = document.getElementById('batteryCount');
            if (batteryCountEl) {
                batteryCountEl.addEventListener('input', function() {
                    config.batteryCount = parseInt(this.value);
                    const valueEl = document.getElementById('batteryCountValue');
                    if (valueEl) valueEl.textContent = config.batteryCount + ' Units';
                    updateSimulation();
                    update3DTopology();
                });
            }
            
            const learningRateEl = document.getElementById('learningRate');
            if (learningRateEl) {
                learningRateEl.addEventListener('input', function() {
                    config.learningRate = parseFloat(this.value);
                    const valueEl = document.getElementById('learningRateValue');
                    const displayEl = document.getElementById('learningRateDisplay');
                    if (valueEl) valueEl.textContent = config.learningRate;
                    if (displayEl) displayEl.textContent = config.learningRate;
                    updateAIConfig();
                });
            }
            
            const psoParticlesEl = document.getElementById('psoParticles');
            if (psoParticlesEl) {
                psoParticlesEl.addEventListener('input', function() {
                    config.psoParticles = parseInt(this.value);
                    const valueEl = document.getElementById('psoParticlesValue');
                    if (valueEl) valueEl.textContent = config.psoParticles;
                    updateAIConfig();
                });
            }
            
            // Economic parameters and other inputs
            ['electricityRate', 'demandCharge', 'carbonFactor', 'maintenanceCost', 
             'inputVoltage', 'frequency', 'ambientPressure', 'lstmLayers', 'trainingEpochs'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        config[id] = parseFloat(this.value) || parseInt(this.value);
                        updateSimulation();
                    });
                }
            });
            
            // Select elements
            ['loadPattern', 'upsMode', 'gridStability'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        config[id] = this.value;
                        updateSimulation();
                    });
                }
            });
        }

        function switchConfigTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.config-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.config-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            if (event && event.target) {
                event.target.classList.add('active');
            }
            const contentEl = document.getElementById(tabName + 'Config');
            if (contentEl) {
                contentEl.classList.add('active');
            }
        }

        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-weight: 600;">${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: white; cursor: pointer; font-size: 18px; margin-left: 15px;">×</button>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 4000);
        }

        function initializeAll() {
            try {
                initCharts();
                init3DTopology();
                startSystem();
            } catch (error) {
                console.error('Initialization error:', error);
                showNotification('Initialization failed. Some features may not work.', 'warning');
            }
        }

        // Enhanced 3D Topology with proper Three.js implementation
        function init3DTopology() {
            if (typeof THREE === 'undefined') {
                console.warn('Three.js not available - 3D topology disabled');
                return;
            }
            
            try {
                const container = document.getElementById('topology3d');
                if (!container) return;
                
                // Scene setup
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x0a0a1a);
                
                camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                container.appendChild(renderer.domElement);

                // Enhanced lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                directionalLight.position.set(-2, 2, 2);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                scene.add(directionalLight);

                const pointLight = new THREE.PointLight(0x667eea, 0.8, 20);
                pointLight.position.set(0, 5, 0);
                scene.add(pointLight);

                // Main UPS Unit with enhanced design
                const upsGroup = new THREE.Group();
                
                // Main chassis
                const upsGeometry = new THREE.BoxGeometry(3, 2, 1.8);
                const upsMaterial = new THREE.MeshPhongMaterial({ 
                    color: 0x2c3e50,
                    shininess: 30,
                    specular: 0x111111
                });
                const upsUnit = new THREE.Mesh(upsGeometry, upsMaterial);
                upsUnit.position.set(0, 0, 0);
                upsUnit.castShadow = true;
                upsUnit.receiveShadow = true;
                upsGroup.add(upsUnit);

                // Control panel with LEDs
                const panelGeometry = new THREE.BoxGeometry(1, 0.8, 0.1);
                const panelMaterial = new THREE.MeshPhongMaterial({ color: 0x34495e });
                const controlPanel = new THREE.Mesh(panelGeometry, panelMaterial);
                controlPanel.position.set(0, 0.4, 0.95);
                upsGroup.add(controlPanel);

                // Status LEDs
                const ledGeometry = new THREE.SphereGeometry(0.06);
                const ledMaterialGreen = new THREE.MeshBasicMaterial({ color: 0x27ae60, emissive: 0x0f5132 });
                const ledMaterialRed = new THREE.MeshBasicMaterial({ color: 0xe74c3c, emissive: 0x8b2635 });
                const ledMaterialBlue = new THREE.MeshBasicMaterial({ color: 0x3498db, emissive: 0x1f4e79 });
                
                for (let i = 0; i < 5; i++) {
                    const ledMaterial = i < 3 ? ledMaterialGreen : (i === 3 ? ledMaterialBlue : ledMaterialRed);
                    const led = new THREE.Mesh(ledGeometry, ledMaterial);
                    led.position.set(-0.4 + i * 0.2, 0.5, 1);
                    upsGroup.add(led);
                    upsComponents[`led${i}`] = led;
                }

                // Cooling fans
                const fanGeometry = new THREE.CylinderGeometry(0.25, 0.25, 0.08, 8);
                const fanMaterial = new THREE.MeshPhongMaterial({ color: 0x7f8c8d });
                
                for (let i = 0; i < 2; i++) {
                    const fan = new THREE.Mesh(fanGeometry, fanMaterial);
                    fan.position.set(-1.2 + i * 2.4, 0.9, 0);
                    fan.rotation.x = Math.PI / 2;
                    upsGroup.add(fan);
                    upsComponents[`fan${i}`] = fan;
                }

                scene.add(upsGroup);
                upsComponents.mainUnit = upsGroup;

                // Enhanced Battery Bank
                update3DTopology();

                // Ground plane with grid
                const groundGeometry = new THREE.PlaneGeometry(14, 10);
                const groundMaterial = new THREE.MeshPhongMaterial({ 
                    color: 0x2c3e50, 
                    transparent: true, 
                    opacity: 0.3,
                    shininess: 10
                });
                const ground = new THREE.Mesh(groundGeometry, groundMaterial);
                ground.rotation.x = -Math.PI / 2;
                ground.position.y = -2;
                ground.receiveShadow = true;
                scene.add(ground);

                // Camera positioning
                camera.position.set(8, 6, 8);
                camera.lookAt(0, 0, 0);

                // Mouse controls for camera
                let mouseX = 0, mouseY = 0;
                let targetX = 0, targetY = 0;
                
                container.addEventListener('mousemove', (event) => {
                    const rect = container.getBoundingClientRect();
                    mouseX = (event.clientX - rect.left - rect.width / 2) / rect.width;
                    mouseY = (event.clientY - rect.top - rect.height / 2) / rect.height;
                });

                // Animation loop
                function animate() {
                    requestAnimationFrame(animate);
                    
                    if (systemActive && upsComponents.mainUnit) {
                        // Rotate main UPS unit
                        upsComponents.mainUnit.rotation.y += 0.002;
                        
                        // Animate cooling fans
                        if (upsComponents.fan0) {
                            upsComponents.fan0.rotation.z += 0.15;
                        }
                        if (upsComponents.fan1) {
                            upsComponents.fan1.rotation.z += 0.12;
                        }
                        
                        // Pulsing LED effect
                        const time = Date.now() * 0.003;
                        for (let i = 0; i < 5; i++) {
                            if (upsComponents[`led${i}`]) {
                                const intensity = 0.5 + 0.3 * Math.sin(time + i * 0.5);
                                upsComponents[`led${i}`].material.emissive.multiplyScalar(intensity);
                            }
                        }
                        
                        // Dynamic camera movement
                        targetX = mouseX * 0.3;
                        targetY = mouseY * 0.3;
                        camera.position.x += (targetX * 3 - camera.position.x + 8) * 0.02;
                        camera.position.y += (targetY * 3 - camera.position.y + 6) * 0.02;
                        camera.lookAt(0, 0, 0);
                    }
                    
                    renderer.render(scene, camera);
                }
                animate();

                // Handle window resize
                window.addEventListener('resize', () => {
                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    camera.aspect = width / height;
                    camera.updateProjectionMatrix();
                    renderer.setSize(width, height);
                });
            } catch (error) {
                console.error('3D initialization error:', error);
            }
        }

        function update3DTopology() {
            if (!scene || typeof THREE === 'undefined') return;
            
            try {
                // Remove existing batteries
                const existingBatteries = scene.getObjectByName('batteryGroup');
                if (existingBatteries) {
                    scene.remove(existingBatteries);
                }
                
                // Add new battery configuration
                const batteryGroup = new THREE.Group();
                batteryGroup.name = 'batteryGroup';
                
                const batteryGeometry = new THREE.BoxGeometry(0.6, 1.4, 0.4);
                const batteryMaterial = new THREE.MeshPhongMaterial({ 
                    color: 0x27ae60,
                    shininess: 50
                });
                
                for (let i = 0; i < config.batteryCount; i++) {
                    const battery = new THREE.Mesh(batteryGeometry, batteryMaterial);
                    battery.position.set(-5 + i * 0.8, -0.3, 0);
                    battery.castShadow = true;
                    
                    // Battery terminals
                    const terminalGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.1);
                    const terminalMaterial = new THREE.MeshPhongMaterial({ color: 0xf1c40f });
                    
                    const posTerminal = new THREE.Mesh(terminalGeometry, terminalMaterial);
                    posTerminal.position.set(-0.15, 0.75, 0);
                    battery.add(posTerminal);
                    
                    const negTerminal = new THREE.Mesh(terminalGeometry, terminalMaterial);
                    negTerminal.position.set(0.15, 0.75, 0);
                    battery.add(negTerminal);
                    
                    batteryGroup.add(battery);
                }
                scene.add(batteryGroup);
            } catch (error) {
                console.error('3D topology update error:', error);
            }
        }

        function initCharts() {
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js not available - charts disabled');
                return;
            }
            
            try {
                // Enhanced Load Chart
                const loadCtx = document.getElementById('loadChart');
                if (loadCtx) {
                    loadChart = new Chart(loadCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: timeLabels,
                            datasets: [{
                                label: 'Load (VA)',
                                data: loadData,
                                borderColor: '#3498db',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                fill: true,
                                tension: 0.4,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: { display: true, text: 'Load (VA)', color: '#ecf0f1' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: '#bdc3c7' }
                                },
                                x: {
                                    title: { display: true, text: 'Time', color: '#ecf0f1' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: '#bdc3c7' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: '#ecf0f1' } }
                            }
                        }
                    });
                }

                // Enhanced Efficiency Chart
                const effCtx = document.getElementById('efficiencyChart');
                if (effCtx) {
                    efficiencyChart = new Chart(effCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: timeLabels,
                            datasets: [{
                                label: 'Efficiency (%)',
                                data: efficiencyData,
                                borderColor: '#27ae60',
                                backgroundColor: 'rgba(39, 174, 96, 0.1)',
                                fill: true,
                                tension: 0.4,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 85, max: 100,
                                    title: { display: true, text: 'Efficiency (%)', color: '#ecf0f1' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: '#bdc3c7' }
                                },
                                x: {
                                    title: { display: true, text: 'Time', color: '#ecf0f1' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: '#bdc3c7' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: '#ecf0f1' } }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Chart initialization error:', error);
            }
        }

        function updateSimulationData() {
            if (!systemActive) return;
            
            try {
                // Enhanced simulation with VA calculations
                const baseVA = config.baseLoad;
                const loadVariation = baseVA * 0.15 * Math.sin(currentTime * 0.1) + (Math.random() - 0.5) * baseVA * 0.05;
                const currentLoadVA = baseVA + loadVariation;
                
                const tempFactor = (config.temperature - 22) * 0.002; // Temperature effect on efficiency
                const humidityFactor = (config.humidity - 45) * 0.0005; // Humidity effect
                const currentEff = 92 + Math.random() * 6 - tempFactor - Math.abs(humidityFactor);
                
                const batteryHealth = 98.5 - (currentTime * 0.0008) + (Math.random() - 0.5) * 0.3;
                const powerQuality = 99.2 + (Math.random() - 0.5) * 0.8;
                
                // Update displays with VA
                const currentLoadEl = document.getElementById('currentLoad');
                const systemEfficiencyEl = document.getElementById('systemEfficiency');
                const batteryHealthEl = document.getElementById('batteryHealth');
                const powerQualityEl = document.getElementById('powerQuality');
                
                if (currentLoadEl) currentLoadEl.textContent = currentLoadVA.toFixed(1) + ' VA';
                if (systemEfficiencyEl) systemEfficiencyEl.textContent = currentEff.toFixed(1) + '%';
                if (batteryHealthEl) batteryHealthEl.textContent = batteryHealth.toFixed(1) + '%';
                if (powerQualityEl) powerQualityEl.textContent = powerQuality.toFixed(1) + '%';
                
                // Enhanced financial calculations
                const realPowerKW = (currentLoadVA * config.powerFactor) / 1000; // Convert VA to kW
                const energySaved = (currentTime * 0.12 + Math.random() * 0.4).toFixed(2);
                const costSavings = (energySaved * config.electricityRate).toFixed(2);
                
                const energySavedEl = document.getElementById('energySaved');
                const costSavingsEl = document.getElementById('costSavings');
                
                if (energySavedEl) energySavedEl.textContent = energySaved + ' kWh';
                if (costSavingsEl) costSavingsEl.textContent = 'R' + costSavings;
                
                // Comprehensive financial calculations
                const dailyCost = (realPowerKW * 24 * config.electricityRate + (currentLoadVA/1000) * config.demandCharge / 30).toFixed(2);
                const monthlyCost = (dailyCost * 30).toFixed(2);
                const annualCost = (dailyCost * 365).toFixed(2);
                const potentialSavings = (annualCost * 0.18).toFixed(2);
                const roiYears = ((config.maintenanceCost + 50000) / potentialSavings).toFixed(1);
                
                const dailyCostEl = document.getElementById('dailyCost');
                const monthlyCostEl = document.getElementById('monthlyCost');
                const annualCostEl = document.getElementById('annualCost');
                const potentialSavingsEl = document.getElementById('potentialSavings');
                const roiPeriodEl = document.getElementById('roiPeriod');
                
                if (dailyCostEl) dailyCostEl.textContent = 'R' + dailyCost;
                if (monthlyCostEl) monthlyCostEl.textContent = 'R' + monthlyCost;
                if (annualCostEl) annualCostEl.textContent = 'R' + annualCost;
                if (potentialSavingsEl) potentialSavingsEl.textContent = 'R' + potentialSavings;
                if (roiPeriodEl) roiPeriodEl.textContent = roiYears + ' years';
                
                // Update chart data
                const timeLabel = String(Math.floor(currentTime) % 24).padStart(2, '0') + ':' + 
                                 String(Math.floor((currentTime % 1) * 60)).padStart(2, '0');
                
                timeLabels.push(timeLabel);
                loadData.push(currentLoadVA);
                efficiencyData.push(currentEff);
                
                if (timeLabels.length > 25) {
                    timeLabels.shift();
                    loadData.shift();
                    efficiencyData.shift();
                }
                
                // Update charts
                if (loadChart && typeof Chart !== 'undefined') {
                    loadChart.data.labels = [...timeLabels];
                    loadChart.data.datasets[0].data = [...loadData];
                    loadChart.update('none');
                }
                
                if (efficiencyChart && typeof Chart !== 'undefined') {
                    efficiencyChart.data.labels = [...timeLabels];
                    efficiencyChart.data.datasets[0].data = [...efficiencyData];
                    efficiencyChart.update('none');
                }
                
                currentTime += 0.3;
            } catch (error) {
                console.error('Simulation update error:', error);
            }
        }

        function updateSimulation() {
            showNotification('Configuration Updated', 'info');
        }

        function updateAIConfig() {
            showNotification('AI Configuration Updated', 'info');
        }

        function startSystem() {
            systemActive = true;
            const statusEl = document.getElementById('systemStatus');
            if (statusEl) {
                statusEl.innerHTML = '<div class="status-indicator"></div>STATUS: ACTIVE - AI Optimization Running';
                statusEl.style.color = '#2ecc71';
            }
            
            if (simulationInterval) clearInterval(simulationInterval);
            simulationInterval = setInterval(updateSimulationData, 2000);
            
            showNotification('System Started - AI Optimization Active', 'success');
        }

        function stopSystem() {
            systemActive = false;
            const statusEl = document.getElementById('systemStatus');
            if (statusEl) {
                statusEl.innerHTML = '<div class="status-indicator" style="background: #e74c3c; box-shadow: 0 0 15px #e74c3c;"></div>STATUS: STOPPED - System Offline';
                statusEl.style.color = '#e74c3c';
            }
            
            if (simulationInterval) clearInterval(simulationInterval);
            showNotification('System Stopped', 'warning');
        }

        function toggleAIMode() {
            aiLearningMode = !aiLearningMode;
            const btn = event.target;
            if (btn) {
                if (aiLearningMode) {
                    btn.textContent = 'AI Learning ON';
                    btn.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                    showNotification('AI Learning Mode Activated', 'success');
                } else {
                    btn.textContent = 'AI Learning';
                    btn.style.background = 'linear-gradient(135deg, #9b59b6, #8e44ad)';
                    showNotification('AI Learning Mode Deactivated', 'info');
                }
            }
        }

        function exportReport() {
            try {
                const reportData = {
                    metadata: {
                        timestamp: new Date().toISOString(),
                        version: "4.0.0",
                        systemStatus: systemActive ? 'Active' : 'Stopped',
                        reportType: "Professional UPS Analysis",
                        generatedBy: "Advanced UPS Optimization Dashboard"
                    },
                    systemConfiguration: {
                        ...config,
                        upsModel: "Professional Grade",
                        installationDate: new Date().toISOString().split('T')[0],
                        lastMaintenance: new Date(Date.now() - 86400000 * 30).toISOString().split('T')[0]
                    },
                    currentMetrics: {
                        load: document.getElementById('currentLoad')?.textContent || 'N/A',
                        efficiency: document.getElementById('systemEfficiency')?.textContent || 'N/A',
                        batteryHealth: document.getElementById('batteryHealth')?.textContent || 'N/A',
                        powerQuality: document.getElementById('powerQuality')?.textContent || 'N/A',
                        energySaved: document.getElementById('energySaved')?.textContent || 'N/A',
                        costSavings: document.getElementById('costSavings')?.textContent || 'N/A'
                    },
                    financialAnalysis: {
                        dailyCost: document.getElementById('dailyCost')?.textContent || 'N/A',
                        monthlyCost: document.getElementById('monthlyCost')?.textContent || 'N/A',
                        annualCost: document.getElementById('annualCost')?.textContent || 'N/A',
                        potentialSavings: document.getElementById('potentialSavings')?.textContent || 'N/A',
                        roiPeriod: document.getElementById('roiPeriod')?.textContent || 'N/A'
                    },
                    performanceData: {
                        timeLabels: [...timeLabels],
                        loadData: [...loadData],
                        efficiencyData: [...efficiencyData],
                        dataPoints: timeLabels.length,
                        averageLoad: (loadData.reduce((a, b) => a + b, 0) / loadData.length || 0).toFixed(2),
                        averageEfficiency: (efficiencyData.reduce((a, b) => a + b, 0) / efficiencyData.length || 0).toFixed(2)
                    },
                    aiMetrics: {
                        modelAccuracy: document.getElementById('modelAccuracy')?.textContent || 'N/A',
                        predictionConfidence: document.getElementById('predictionConfidence')?.textContent || 'N/A',
                        trainingSamples: document.getElementById('trainingSamples')?.textContent || 'N/A',
                        learningRate: config.learningRate,
                        psoParticles: config.psoParticles
                    },
                    recommendations: [
                        "Continue current optimization settings for maximum efficiency",
                        "Schedule maintenance check in 30 days",
                        "Monitor battery health trends for predictive replacement",
                        "Consider load balancing during peak hours"
                    ]
                };
                
                // Create comprehensive text report
                const reportText = `
PROFESSIONAL UPS OPTIMIZATION REPORT
Generated: ${new Date().toLocaleString()}
Report ID: UPS-${Date.now()}
========================================

EXECUTIVE SUMMARY
System Status: ${systemActive ? 'ACTIVE' : 'STOPPED'}
Overall Health: Excellent
Efficiency Rating: ${reportData.currentMetrics.efficiency}
Recommended Action: Continue Current Configuration

SYSTEM CONFIGURATION
Base Load: ${config.baseLoad} VA
UPS Mode: ${config.upsMode}
Battery Configuration: ${config.batteryCount} Units
Power Factor: ${config.powerFactor}
Input Voltage: ${config.inputVoltage}V
Frequency: ${config.frequency}Hz

ENVIRONMENTAL CONDITIONS
Temperature: ${config.temperature}°C
Humidity: ${config.humidity}%
Grid Stability: ${config.gridStability}
Ambient Pressure: ${config.ambientPressure} kPa

CURRENT PERFORMANCE METRICS
Current Load: ${reportData.currentMetrics.load}
System Efficiency: ${reportData.currentMetrics.efficiency}
Battery Health: ${reportData.currentMetrics.batteryHealth}
Power Quality: ${reportData.currentMetrics.powerQuality}
Energy Saved: ${reportData.currentMetrics.energySaved}
Cost Savings: ${reportData.currentMetrics.costSavings}

FINANCIAL ANALYSIS (ZAR)
Daily Energy Cost: ${reportData.financialAnalysis.dailyCost}
Monthly Estimate: ${reportData.financialAnalysis.monthlyCost}
Annual Projection: ${reportData.financialAnalysis.annualCost}
Potential Savings: ${reportData.financialAnalysis.potentialSavings}
ROI Period: ${reportData.financialAnalysis.roiPeriod}

AI MODEL PERFORMANCE
Model Accuracy: ${reportData.aiMetrics.modelAccuracy}
Prediction Confidence: ${reportData.aiMetrics.predictionConfidence}
Training Samples: ${reportData.aiMetrics.trainingSamples}
Learning Rate: ${reportData.aiMetrics.learningRate}
PSO Particles: ${reportData.aiMetrics.psoParticles}

PERFORMANCE DATA SUMMARY
Data Points Collected: ${reportData.performanceData.dataPoints}
Average Load: ${reportData.performanceData.averageLoad} VA
Average Efficiency: ${reportData.performanceData.averageEfficiency}%

RECOMMENDATIONS
${reportData.recommendations.map((rec, index) => `${index + 1}. ${rec}`).join('\n')}

DETAILED DATA (JSON)
${JSON.stringify(reportData, null, 2)}

========================================
Report Generated by Advanced UPS Optimization Dashboard v4.0.0
Professional Edition | AI-Driven Analytics
`;
                
                const blob = new Blob([reportText], { 
                    type: 'text/plain;charset=utf-8' 
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `UPS_Professional_Report_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.txt`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('Professional Report Generated Successfully', 'success');
                
                // Also create JSON version
                const jsonBlob = new Blob([JSON.stringify(reportData, null, 2)], {
                    type: 'application/json'
                });
                const jsonUrl = URL.createObjectURL(jsonBlob);
                const jsonA = document.createElement('a');
                jsonA.href = jsonUrl;
                jsonA.download = `UPS_Data_Export_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.json`;
                jsonA.style.display = 'none';
                document.body.appendChild(jsonA);
                jsonA.click();
                document.body.removeChild(jsonA);
                URL.revokeObjectURL(jsonUrl);
                
            } catch (error) {
                console.error('Export error:', error);
                showNotification('Report Export Failed - Check Console', 'error');
            }
        }
    </script>
</body>
</html>